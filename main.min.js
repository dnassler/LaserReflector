function gamePaused(){}function gameResumed(){}function helpButtonCallback(){console.log("helpButtonCallback: about to show intro info"),showIntroInfo(),console.log("helpButtonCallback: OUT")}function updateGameLevelTimer(){gameOver||0===savedGameTime&&1!=debug&&(gameLevelTimer-=1,0>gameLevelTimer&&(gameLevelTimer=0),setTextRight(timerText,gameLevelTimer.toString()),0>=gameLevelTimer?(audioGameOver.play(),gameLevelTimeout()):10==gameLevelTimer?timerTextTween=game.add.tween(timerText).to({alpha:0},100,Phaser.Easing.Linear.None,!0).to({alpha:1},100,Phaser.Easing.Linear.None,!0,0,100,!0):gameLevelTimer>10&&null!=timerTextTween&&timerTextTween.isRunning&&(console.log("*************** stopping tween"),timerTextTween.stop()))}function rotateTriangleReflector(a,b){var c;c=b?90*Math.floor(4*Math.random()):Phaser.Math.snapToFloor(a.angle,90)+90,game.add.tween(a).to({angle:c},500,Phaser.Easing.Linear.None,!0).onComplete.add(function(){a.angle=Phaser.Math.snapToFloor(a.angle,90)},this)}function fullscreenKeyPressed(){game.scale.startFullScreen()}function createGameElement(a,b,c){var d,e,f=findEmptyGridLocation();d=f.x,e=f.y;var g=game.add.sprite(d,e,a,c);return g.shapeId=nextUniqueShapeId++,g.anchor.setTo(.5,.5),b&&(g.angle=90*Math.floor(4*Math.random())),g.name=a,g}function fixSnapLocationReflector(a){a.isReflectorBeingDragged=!1,a.gameTimeOfLastManualMove=game.time.now;var b=snapToShapeGrid({x:a.x,y:a.y}),c=b.x,d=b.y;if(!isValidGridLocation(c,d))return a.x=a.saveShapeOriginalPositionX,void(a.y=a.saveShapeOriginalPositionY);c===a.saveShapeOriginalPositionX&&d===a.saveShapeOriginalPositionY&&rotateTriangleReflector(a,!1),console.log("\n\n\nfixSnapLocationReflector: IN reflectorSprite.shapeId="+a.shapeId+", toX="+c+", toY="+d);var e=hasShapeAtXY(c,d);e&&console.log("fixSnapLocationReflector: hasShapeAtXY(toX,toY)="+e.shapeId);var f;f=e&&e.shapeId!=a.shapeId?tryGetNearbyLocation(c,d):{x:c,y:d},a.x=f.x,a.y=f.y}function isValidGridLocation(a,b,c){var d,e,f;return c?(f=snapToShapeGrid({x:a,y:b}),d=f.x,e=f.y):(d=a,e=b),d>leftLimitX&&rightLimitX>d&&e>topLimitY&&bottomLimitY>e?!0:!1}function fireButtonPressed(){if(console.log("fireButtonPressed IN"),laserPathId+=1,laserFiring&&stopFiringLaserCallback(),!gameOver&&shooterDead)return void console.log("fireButtonPressed: ignoring because the shooter is dead");if(gameOver||shooterDead)return game.time.now>timeMarkerGameOver?void restartGame():void console.log("fireButtonPressed: game is over or the shooter is dead so ignoring the fire button");console.log("fireButtonPressed: shooter must not be dead. shooterDead="+shooterDead),laserFiring=!0,savedGameTimeAtLastLaserFiring=game.time.now,timeMarkerCheckIfLaserFiredRecently=game.time.now+3e3*Math.random()+5e3,audioLaserFired.play(),saveShooterVelocityX=shooter1.body.velocity.x,saveShooterVelocityY=shooter1.body.velocity.y,console.log("\n\n\n\n\n\n*************\nfireButtonPressed: setting saveShooterVelocityX="+saveShooterVelocityX+", shooter1.body.velocity.x="+shooter1.body.velocity.x),shooter1.body.velocity.setTo(0,0);var a=shooter1.x,b=shooter1.y,c=drawLaserFrom(a,b);console.log("\nfireButtonPressed: after drawLaserFrom\n\n\n"),laserLayerSprite1.visible=!0,laserLayerSprite1.alpha=1,savedPrizeHitCountPerShotArr.push(c.prizeArr.length);var d=avgHitCount(4),e=avgHitScore(4),f=game.time.now-savedGameTimeAtLastLaserFiring,g=(game.time.now-savedGameTimeAtLastComment,c.prizeArr.length),h=0;if(g>0&&(c.prizeArr.forEach(function(a){"timeBomb"===a.name&&(h+=1)}),savedPrizeHitScorePerSuccessfulShotArr.push(c.hitScore)),c.isReflectingBack?c.numLaserBounces>=3?showBonusInfo(game.rnd.pick(msgDieHardArr),3e3):0===c.numLaserBounces?0===g?showBonusInfo(game.rnd.pick(msgDieEasyArr),3e3):h>=1?showBonusInfo(game.rnd.pick(msgDieEasyWithTimeBomb),3e3):showBonusInfo(game.rnd.pick(msgDieEasyWithPrize),3e3):1===c.numLaserBounces&&(g>0?showBonusInfo(game.rnd.pick(msgDie1BounceWithPrizeArr),3e3):showBonusInfo(game.rnd.pick(msgDie1BounceWithoutPrizeArr),3e3)):c.numLaserBounces>=3&&c.hitScore>5?showBonusInfo("Really Nice shot!",2e3):c.numLaserBounces>=3&&c.hitScore>1?showBonusInfo("Cool.",2e3):c.numLaserBounces>=2&&c.hitScore>3?showBonusInfo(game.rnd.pick(msgRiskyGood),3e3):c.numLaserBounces>=2&&c.hitScore>0?showBonusInfo(game.rnd.pick(msg2BouncesOkay),3e3):c.numLaserBounces>=3?showBonusInfo("Reflecting Lasers Are Fun!",3e3):0===g?savedPrizeHitCountPerShotArr.length>4&&0===d&&timeSinceLastCommentOfType("NoHits")>3e3&&200>f&&showBonusInfo(game.rnd.pick(msgShootingNoHits),3e3,"NoHits"):savedPrizeHitCountPerShotArr.length>4&&2>=e?showBonusInfo(game.rnd.pick(msgEasyLowHits),3e3):game.time.now-savedGameTimeAtLastRestartLevel<5e3&&e>2&&d>=1&&2===savedPrizeHitCountPerShotArr.length&&showBonusInfo("Not A Bad Start",3e3),c.isReflectingBack&&(laserTimerEvent=game.time.events.loop(100,laserTimerEventCallback,this),1!=debug&&(totalHealthShooter-=1)),c.prizeArr.length>0){audioPrizeHit.play();var i=0,j=!1;if(c.prizeArr.forEach(function(a){"redBox"===a.name&&(i+=1)}),i>0&&redBoxGroup.countLiving()===i)return j=!0,audioRedBoxesHit.play(),showBonusInfo("Oh Good!",2e3),redBoxGroup.forEachAlive(function(a){game.add.tween(a.scale).to({x:2,y:2},100,Phaser.Easing.Linear.None,!0,0,20,!0).onComplete.add(function(){a.scale.setTo(1,1)})}),void laserHitAllRedBoxes();c.prizeArr.forEach(function(a){game.add.tween(a.scale).to({x:2,y:2},100,Phaser.Easing.Linear.None,!0,0,5,!0),gameLevelTimer+=a.prizeTimeOffset?a.prizeTimeOffset:extraGameTimePerPrize,a.wasHit=!0,game.add.tween(a).to({alpha:0},500,Phaser.Easing.Linear.None,!0).onComplete.add(function(){if(a.wasHit=!1,a.scale.setTo(1,1),"greenBox"===a.name||"greenBox10"===a.name||"greenBox10time"===a.name||"redBox"===a.name){var b=findEmptyGridLocation();a.x=b.x,a.y=b.y,game.add.tween(a).to({alpha:1},500,Phaser.Easing.Linear.None,!0).onComplete.add(function(){a.scale.setTo(1,1)})}else"timeBomb"===a.name&&(a.alpha=1,destroyedTimeBomb(a))},this)}),totalPrizeHits+=c.hitScore}if(c.spriteCollideArr.length>0&&c.spriteCollideArr.forEach(function(a){"boxReflector1"!==a.name&&(a.tint=16751001,game.time.events.add(3*Phaser.Timer.SECOND,function(){a.tint=16777215},this))}),setTextRight(healthText,totalHealthShooter.toString()),setTextRight(scoreText,totalPrizeHits.toString()),stopLaserFiringTimerHandle=game.time.events.add(200,stopFiringLaserCallback,this),c.isReflectingBack){var k=shooterDirection();if(k.isUp||k.isDown){var l=game.add.tween(shooter1).to({x:shooter1.x+10},50,Phaser.Easing.Linear.None,!1).chain(game.add.tween(shooter1).to({x:shooter1.x-10},50,Phaser.Easing.Linear.None,!1)).repeat(9).chain(game.add.tween(shooter1).to({x:shooter1.x},25,Phaser.Easing.Linear.None,!1));l.start()}else{var l=game.add.tween(shooter1).to({y:shooter1.y+10},50,Phaser.Easing.Linear.None,!1).chain(game.add.tween(shooter1).to({y:shooter1.y-10},50,Phaser.Easing.Linear.None,!1)).repeat(9).chain(game.add.tween(shooter1).to({y:shooter1.y},25,Phaser.Easing.Linear.None,!1));l.start()}audioShooterDies.play(),shooterDies()}}function fireButtonReleased(){stopFiringLaserCallback()}function stopFiringLaserCallback(){laserFiring&&(laserFiring=!1,stopLaserFiringTimerHandle&&(game.time.events.remove(stopLaserFiringTimerHandle),stopLaserFiringTimerHandle=null),laserLayerSprite1.visible=!1,laserTrailTween&&(laserTrailTween.stop(),laserTrailTween=null),laserTrailSprite.visible=!0,laserTrailSprite.alpha=1,laserTrailTween=game.add.tween(laserTrailSprite).to({alpha:0},500,Phaser.Easing.Linear.None,!0),laserTimerEvent&&(console.log("removing timer event"),game.time.events.remove(laserTimerEvent),laserTimerEvent=null),gameOver||shooterDead||(console.log("fireButtonReleased: saveShooterVelocityX="+saveShooterVelocityX),null!=saveShooterVelocityX&&shooter1.body.velocity.setTo(saveShooterVelocityX,saveShooterVelocityY)))}function shooterDies(){console.log("shooterDies: IN"),shooterDead=!0,fireButtonReleased(),fadeOutAllTimeBombs(),shooter1.body.velocity.setTo(0,0),game.add.tween(shooter1).to({alpha:0},2e3,Phaser.Easing.Linear.None,!0,500),totalHealthShooter>0?game.time.events.add(3e3,restartLevel,this):game.time.events.add(1e3,gameLevelTimeout,this),console.log("shooterDies: OUT")}function gameLevelTimeout(){gameOver=!0,shooterDead=!0,removeAndKillAllTimeBombEvents(),gameLevelTimerEvent&&(game.time.events.remove(gameLevelTimerEvent),gameLevelTimerEvent=null),console.log("************** GAME OVER *****************");var a=totalPrizeHits;finalScoreText.visible=!0,finalScoreText.setText(a),game.add.tween(finalScoreText).to({y:game.world.centerY},1e3,Phaser.Easing.Back.Out,!0),endingSequenceAllReflectors(),game.time.events.add(5*Phaser.Timer.SECOND,function(){shooter1.visible=!1,finalScoreText.visible=!1,gameOverlayTextGroup.visible=!0,gameOverlayText.visible=!0,gameplayObjectsGroup.visible=!1},this),game.time.events.add(20*Phaser.Timer.SECOND,function(){gameOverlayText.visible=!1,finalScoreText.visible=!1,game.time.events.loop(10*Phaser.Timer.SECOND,function(){gameOverlayText.visible=!gameOverlayText.visible},this)},this),timeMarkerGameOver=game.time.now+2e3}function showIntroInfo(){1!=debug&&gameOver&&(console.log("showIntroInfo: IN"),gameOverlayTextGroup.visible=!1,introInfoGroup.visible=!0,gameHelpButton.visible=!1,finalScoreText.visible=!1,hideIntroInfoTimer=game.time.events.add(60*Phaser.Timer.SECOND,hideIntroInfo,this))}function hideIntroInfo(){gameOver&&(console.log("hideIntroInfo: IN"),hideIntroInfoTimer&&(game.time.events.remove(hideIntroInfoTimer),hideIntroInfoTimer=!1),gameOverlayTextGroup.visible=!0,introInfoGroup.visible=!1,gameHelpButton.visible=!0,gameOverlayTextGroup.visible=!0)}function isShowingIntroInfo(){return introInfoGroup.visible}function restartGame(){gameOver=!1,timeMarkerShuffleAllReflectors=0,savedGameTime=0,removeActiveTimers(),removeAndKillAllTimeBombEvents(),scrambleAllObjects(),introInfoGroup.visible=!1,gameOverlayTextGroup.visible=!1,gameplayObjectsGroup.visible=!0,finalScoreText.visible=!1,finalScoreText.y=-500,finalScoreText.setText(""),totalHealthShooter=maxHealthShooter,totalPrizeHits=0,gameLevelTimer=maxGameLevelTime,setTextRight(healthText,totalHealthShooter.toString()),setTextRight(scoreText,totalPrizeHits.toString()),setTextRight(timerText,gameLevelTimer.toString()),timerText.alpha=1,startupSequenceAllReflectors(),game.time.events.add(Phaser.Timer.SECOND,function(){setTextCenter(gameStartingText,"GET READY!\n\n3",!0,!0),gameStartingText.visible=!0},this),game.time.events.add(2*Phaser.Timer.SECOND,function(){setTextCenter(gameStartingText,"GET READY!\n\n2",!0,!0)},this),game.time.events.add(3*Phaser.Timer.SECOND,function(){setTextCenter(gameStartingText,"GET READY!\n\n1",!0,!0)},this),game.time.events.add(4*Phaser.Timer.SECOND,function(){audioGameStart.play(),gameStartingText.visible=!1,restartLevel(),gameLevelTimerEvent&&game.time.events.remove(gameLevelTimerEvent),gameLevelTimerEvent=game.time.events.loop(Phaser.Timer.SECOND,updateGameLevelTimer,this),timeMarkerShuffleAllReflectors=game.time.now+6e4,timeMarkerMoveBlueSquares=game.time.now+1e3,timeMarkerShuffleBlueReflectors=game.time.now+5e3*Math.random()+25e3,timeMarkerMovePrizes=game.time.now+2e3,timeMarkerMoveTimeBomb=game.time.now+1e3,timeToLaunchTimeBomb=game.time.now+timeBombIntervalNextBombLaunch(),timeMarkerTweakTriangles=game.time.now+2e3,timeMarkerShowRedBoxes=game.time.now+timeToShowRedBoxesAfterGameStart(),timeMarkerCheckIfLaserFiredRecently=game.time.now+3e3*Math.random()+3e3},this)}function restartLevel(){var a=[topLimitY,bottomLimitY],b=[90,270],c=[-defShooterVelocity,defShooterVelocity];removeAndKillAllTimeBombEvents(),saveShooterVelocityX=null,saveShooterVelocityY=null,shooterDead=!1,shooter1.visible=!0,shooter1.alpha=1,setShooterAngle(Phaser.Math.getRandom(b)),shooter1.x=game.world.centerX,shooter1.y=Phaser.Math.getRandom(a),shooter1.body.angularVelocity=0,shooter1.body.acceleration.setTo(0,0),shooter1.body.velocity.setTo(0,0),shooter1.body.velocity.x=Phaser.Math.getRandom(c),setTextRight(healthText,totalHealthShooter.toString()),setTextRight(scoreText,totalPrizeHits.toString()),setTextRight(timerText,gameLevelTimer.toString()),timerText.alpha=1,resetGamePlayStats()}function laserTimerEventCallback(){laserLayerSprite1.alpha=1==laserLayerSprite1.alpha?.1:1}function drawLaserFrom(a,b){1==debug&&console.log("\n\n\n\n\n\n-----------------------------------------\ndrawLaserFrom: IN");var c=laserLayerBM1.context,d=laserTrailBM.context;laserLayerBM1.clear(),laserTrailBM.clear(),c.strokeStyle="#ff0000",c.lineWidth=laserWidth,c.beginPath(),d.strokeStyle="#ffffff",d.globalAlpha=1,d.lineWidth=laserTrailWidth,d.beginPath();var e,f,g;e=a,f=b;var h=!1,i=[];c.moveTo(e,f),i.push({x:e,y:f});for(var j=shooterDirection(),k=[],l=[],m=0,n=0,o=0,p=0;(!g||!g.isLastSegment)&&200>p;){if(p+=1,1==debug&&console.log("drawLaserFrom: in while, numLaserBounces="+m+", laserDirection="+stringForDir(j)+", lx0="+e+", ly="+f),g=calcLineSegment(j,e,f),c.lineTo(g.x1,g.y1),0===m){d.save();var q=d.createLinearGradient(e,f,g.x1,g.y1);q.addColorStop(0,"#000"),q.addColorStop(.5,"#fff"),q.addColorStop(1,"#fff"),d.strokeStyle=q,d.moveTo(e,f),d.lineTo(g.x1,g.y1),d.stroke(),d.restore(),d.beginPath(),d.moveTo(g.x1,g.y1)}else d.lineTo(g.x1,g.y1);i.push({x:g.x1,y:g.y1}),g.spriteCollide&&l.push(g.spriteCollide),h=g.isReflectingBack,k=k.concat(g.prizeArr),o=0,g.prizeArr.forEach(function(a){var b=0;b=a.prizePoints?a.prizePoints:0,o+=b}),20140404==debug&&console.log("drawLaserFrom: prizePointsForSegment="+o),n+=o*(m+1),j=g.laserReflectionDirection,1==debug&&console.log("drawLaserFrom: in while after calcLineSegment, , laserReflectionDirection="+stringForDir(j)+", calcuatedLineSegmentInfo.x1="+g.x1+", y1="+g.y1+", isLastSegment="+g.isLastSegment),e=g.x1,f=g.y1,g.isLastSegment||(m+=1)}return c.stroke(),d.stroke(),console.log("drawLaserFrom: OUT isReflectingBack="+h),{isReflectingBack:h,numLaserBounces:m,hitScore:n,prizeArr:k,spriteCollideArr:l,laserPath:i}}function touchListenerOnUp(){laserFiring&&fireButtonReleased()}function clickListener(){console.log("\n\nclickListener: IN***"),gameOver&&(isShowingIntroInfo()?hideIntroInfo():game.input.y>game.world.height-300&&game.input.y<game.world.height-200&&game.input.x>game.world.width-100||fireButtonPressed()),console.log("clickListener: OUT\n\n\n")}function calcLineSegment(a,b,c){console.log("calcLineSegment: IN");var d={x0:b,y0:c,isReflectingBack:!1,isLastSegment:!0},e=firstSpriteHit(a,b,c);if(e){1===debug&&console.log("calcLineSegment: sprite found for line segment! sprite.x="+e.x+", sprite.y="+e.y+", sprite.angle="+e.angle);var f=calcHitPoint(a,e,b,c);d.x1=f.x1,d.y1=f.y1,d.isReflectingBack=f.isReflectingBack,d.isLastSegment=f.isLastSegment,d.laserReflectionDirection=f.laserReflectionDirection,d.spriteCollide=e}else{1==debug&&console.log("calcLineSegment: no sprite collision, so go to edge of the world");var g=lineFromDirectionAndXY(a,b,c);d.x1=g.x1,d.y1=g.y1}return d.prizeArr=collectPrizesOnLine(a,d.x0,d.y0,d.x1,d.y1),1==debug&&console.log("calcLineSegment: r.prizeArr.lenth="+d.prizeArr.length),d}function collectPrizesOnLine(a,b,c,d,e){var f=[];return console.log("collectPrizesOnLine: IN"),prizeGroup.forEach(function(g){g.alive&&!g.wasHit&&isPrizeOnLine(g,a,b,c,d,e)&&(console.log("collectPrizesOnLine: found prize x="+g.x+", y="+g.y),f.push(g))}),redBoxGroup.forEach(function(g){console.log("collectPrizesOnLine: redBoxGroup prize.shapeId="+g.shapeId+", prize.alive="+g.alive),g.alive&&!g.wasHit&&isPrizeOnLine(g,a,b,c,d,e)&&(console.log("collectPrizesOnLine: found prize x="+g.x+", y="+g.y),f.push(g))}),timeBombGroup.forEach(function(g){g.alive&&!g.wasHit&&isPrizeOnLine(g,a,b,c,d,e)&&(console.log("collectPrizesOnLine: found prize x="+g.x+", y="+g.y),f.push(g))}),console.log("collectPrizesOnLine: OUT  prizeArr.length="+f.length),f}function isShapeOnPath2(a,b,c,d){var e=lineFromDirectionAndXY(b,c,d);return isPrizeOrShapeOnLine(a,shapeWidth,b,c,d,e.x1,e.y1)}function isPrizeOnLine(a,b,c,d,e,f){return isPrizeOrShapeOnLine(a,prizeWidth,b,c,d,e,f)}function isPrizeOrShapeOnLine(a,b,c,d,e,f,g){if(1==debug&&console.log("isPrizeOrShapeOnLine: obj.name="+a.name+", obj.x="+a.x+", obj.y="+a.y+", sw="+b+", d="+stringForDir(c)+", x0="+d+", y0="+e+", x1="+f+", y1="+g),Math.abs(a.x-d)<=b/2&&Math.abs(a.y-e)<=b/2)return 1==debug&&console.log("isPrizeOrShapeOnLine: ignore obj"),!1;var h=d,i=e,j=laserWidth/2+b/2;if(c.isUp||c.isDown){if(isBetween(a.y,e,g,j)&&Math.abs(a.x-h)<j)return!0}else if(isBetween(a.x,d,f,j)&&Math.abs(a.y-i)<j)return!0;return!1}function isBetween(a,b,c,d){return a>b-d&&c+d>a||b+d>a&&a>c-d}function lineFromDirectionAndXY(a,b,c){var d;return d=a.isUp?{x0:b,y0:c,x1:b,y1:0}:a.isDown?{x0:b,y0:c,x1:b,y1:game.world.height}:a.isLeft?{x0:b,y0:c,x1:0,y1:c}:{x0:b,y0:c,x1:game.world.width,y1:c}}function isShapeTriangle(a){return"triangleReflector1"==a.name?!0:!1}function isShapeBoxReflector(a){return"boxReflector1"===a.name?!0:!1}function calcHitPoint(a,b,c,d){var e={isReflectingBack:!1,isLastSegment:!0};e.laserReflectionDirection={isUp:!1,isDown:!1,isLeft:!1,isRight:!1};var f;if(1==debug&&console.log("calcHitPoint: in"),isShapeTriangle(b)&&(1==debug&&console.log("calcHitPoint: triangle"),f=hitTriangleDiagonal(a,c,d,b),1==debug&&console.log("calcHitPoint: triangleHitDiagonalInfo.hitDiagonal="+f.hitDiagonal)),isShapeTriangle(b)&&f.hitDiagonal)1==debug&&console.log("calcHitPoint: hitDiagonal***"),e.isLastSegment=!1,e.laserReflectionDirection=f.laserReflectionDirection,e.x1=f.hitPointXY.x,e.y1=f.hitPointXY.y,1==debug&&console.log("calcHitPoint: triangle, diagonal, hitPointXY="+e.x1+"/"+e.y1);else{var g=shapeWidth/2;if(a.isDown?(e.x1=c,e.y1=b.y-g):a.isUp?(e.x1=c,e.y1=b.y+g):a.isLeft?(e.x1=b.x+g,e.y1=d):(e.x1=b.x-g,e.y1=d),"boxReflector1"==b.name){var h=b.frame,i=b.animations.getAnimation("safeMode");1==debug&&console.log("!!!!!!!******** boxReflector1 isPlaying="+i.isPlaying+", frame="+h),0!=h||i.isPlaying||(e.isReflectingBack=!0,b.play("flashRed"),game.time.events.add(1e3,function(){b.animations.getAnimation("flashRed").stop(),b.frame=0},this)),e.laserReflectionDirection=invertLaserDirection(a)}}return e}function invertLaserDirection(a){var b={isUp:!1,isDown:!1,isLeft:!1,isRight:!1};return a.isUp&&(b.isDown=!0),a.isDown&&(b.isUp=!0),a.isLeft&&(b.isRight=!0),a.isRight&&(b.isLeft=!0),b}function hitTriangleDiagonal(a,b,c,d){var e,f,g,h,i=!1,j={},k={isLeft:!1,isRight:!1,isUp:!1,isDown:!1},l={},m=triangleReflectDirection(d);if(a.isDown&&m.isUp?(i=!0,m.isLeft?(g=d.x-b,e=b,f=d.y+g,l.x0=1,l.y0=-1,l.x1=-1,l.y1=1,k.isLeft=!0):(g=b-d.x,e=b,f=d.y+g,l.x0=-1,l.y0=-1,l.x1=1,l.y1=1,k.isRight=!0)):a.isUp&&m.isDown?(i=!0,m.isLeft?(g=b-d.x,e=b,f=d.y+g,k.isLeft=!0,l={x0:-1,y0:-1,x1:1,y1:1}):(g=d.x-b,e=b,f=d.y+g,k.isRight=!0,l={x0:1,y0:-1,x1:-1,y1:1})):a.isLeft&&m.isRight?(i=!0,m.isUp?(h=c-d.y,e=d.x+h,f=c,k.isUp=!0,l={x0:-1,y0:-1,x1:1,y1:1}):(h=d.y-c,e=d.x+h,f=c,k.isDown=!0,l={x0:1,y0:-1,x1:-1,y1:1})):a.isRight&&m.isLeft&&(i=!0,m.isUp?(h=d.y-c,e=d.x+h,f=c,k.isUp=!0,l={x0:1,y0:-1,x1:-1,y1:1}):(h=c-d.y,e=d.x+h,f=c,k.isDown=!0,l={x0:-1,y0:-1,x1:1,y1:1})),j.hitDiagonal=i,!i)return j;d.width/2;return j.laserReflectionDirection=k,j.hitPointXY={x:e,y:f},j}function triangleReflectDirection(a){var b={up:!1,down:!1,left:!1,right:!1};return 0==a.angle?(b.isUp=!0,b.isRight=!0):-90==a.angle?(b.isUp=!0,b.isLeft=!0):90==a.angle?(b.isDown=!0,b.isRight=!0):(b.isDown=!0,b.isLeft=!0),b}function firstSpriteHit(a,b,c){var d=findObjectsOnPath(a,b,c);return 0==d.length?null:d.shift()}function findObjectsOnPath(a,b,c){var d=[];1==debug&&console.log("findObjectsOnPath: IN  "+stringForDir(a)+", x0="+b+", y0="+c);for(var e=0;e<reflectorGroup1.length;e++){var f=reflectorGroup1.getAt(e);if(f.alive){if(!isShapeOnPath2(f,a,b,c))continue;d.push(f)}}return d.sort(function(b,c){return a.isDown?b.y-c.y:a.isUp?c.y-b.y:a.isRight?b.x-c.x:c.x-b.x}),d}function isShapeBelow(a,b,c){return a.y>c&&a.x==b?!0:!1}function isShapeAbove(a,b,c){return a.y<c&&a.x==b?!0:!1}function isShapeToTheRight(a,b,c){return a.x>b&&a.y==c?!0:!1}function isShapeToTheLeft(a,b,c){return a.x<b&&a.y==c?!0:!1}function isShapeOnPath(a,b,c,d){return a.isDown?isShapeBelow(b,c,d):a.isUp?isShapeAbove(b,c,d):a.isRight?isShapeToTheRight(b,c,d):isShapeToTheLeft(b,c,d)}function shooterDirection(){var a=getShooterAngle(),b={};return 0==a?b.isRight=!0:-180==a?b.isLeft=!0:90==a?b.isDown=!0:b.isUp=!0,b}function clickOnBoxReflectorListener(a){a.play("safeMode")}function reorientShooterAsNecessary(){var a=shooterDirection(),b=!1;if(game.time.now>timeMarkerReorient){var c=Math.abs(shooter1.body.velocity.x+shooter1.body.velocity.y);if(1==debug&&console.log("reorientShooterAsNecessary: saveVelocity="+c+", velocity.x="+velocity.x+", velocity.y="+velocity.y),0==c)return void(1==debug&&console.log("reorientShooterAsNecessary: do nothing!!!"));shooter1.x>rightLimitX&&a.isDown?(b=!0,setShooterAngle(180),shooter1.body.velocity.setTo(0,c),shooter1.x=rightLimitX):shooter1.y<topLimitY&&a.isLeft?(b=!0,setShooterAngle(90),shooter1.body.velocity.x=-c,shooter1.body.velocity.y=0,shooter1.y=topLimitY):shooter1.y>bottomLimitY&&a.isLeft?(b=!0,setShooterAngle(270),shooter1.body.velocity.y=0,shooter1.body.velocity.x=-c,shooter1.y=bottomLimitY):shooter1.x>rightLimitX&&a.isUp?(b=!0,setShooterAngle(180),shooter1.body.velocity.x=0,shooter1.body.velocity.y=-c,shooter1.x=rightLimitX):shooter1.x<leftLimitX&&a.isUp?(b=!0,setShooterAngle(0),shooter1.body.velocity.x=0,shooter1.body.velocity.y=-c,shooter1.x=leftLimitX):shooter1.y>bottomLimitY&&a.isRight?(b=!0,setShooterAngle(270),shooter1.body.velocity.x=c,shooter1.body.velocity.y=0,shooter1.y=bottomLimitY):shooter1.y<topLimitY&&a.isRight?(b=!0,setShooterAngle(90),shooter1.body.velocity.x=c,shooter1.body.velocity.y=0,shooter1.y=topLimitY):shooter1.x<leftLimitX&&a.isDown&&(b=!0,setShooterAngle(0),shooter1.body.velocity.setTo(0,c),shooter1.x=leftLimitX)}b&&(timeMarkerReorient=game.time.now+200),a.isDown?shooter1.y=topLimitY:a.isUp?shooter1.y=bottomLimitY:shooter1.x=a.isLeft?rightLimitX:leftLimitX}function snapToShapeGrid(a){return{x:Phaser.Math.snapToFloor(a.x-extraWidth/2,gridSize)+halfGridSize+extraWidth/2,y:Phaser.Math.snapToFloor(a.y-extraHeight/2,gridSize)+halfGridSize+extraHeight/2}}function hasShapeAtXY(a,b){return hasShapeAt({x:a,y:b})}function hasShapeAt(a){for(var b=snapToShapeGrid(a),c=b.x,d=b.y,e=0;e<allGridObjectsArr.length;e++){var f=allGridObjectsArr[e];if(f.alive&&c===f.x&&d===f.y)return f}return!1}function shapeCountAtLocation(a,b){var c=findShapesAt(a,b);return c.length}function findShapesAt(a,b){var c=[];return allGridObjectsArr.forEach(function(d){d.alive&&a==d.x&&b==d.y&&c.push(d)}),c}function updateSingleObjectPosition(a){if(a.alive){var b=getFreeAdjacentLocations(a.x,a.y);if(0!=b.length){var c=Phaser.Math.getRandom(b);game.add.tween(a).to({x:c.x,y:c.y},500,Phaser.Easing.Back.Out,!0).onComplete.add(function(){var b=snapToShapeGrid({x:c.x,y:c.y});a.x=b.x,a.y=b.y,console.log("updateSingleObjectPosition: completed move, checking if need to move again");var d=shapeCountAtLocation(c.x,c.y);d>1?(console.log("updateSingleObjectPosition: moving shape again"),updateSingleObjectPosition(a)):console.log("updateSingleObjectPosition: did not need to move again")},this),isShapeTriangle(a)?(audioSlidingTriangle.play(),rotateTriangleReflector(a,!0)):"greenBox"==a.name||"greenBox10"==a.name||"greenBox10time"==a.name?audioSlidingPrize.play():audioSliding.play()}}}function updateObjectPositions(a,b,c){if(0===debug){var d=[];if(a.forEach(function(a){(!a.gameTimeOfLastManualMove||game.time.now-a.gameTimeOfLastManualMove>15e3)&&d.push(a)}),b)d.forEach(function(a){a.alive&&!a.wasHit&&updateSingleObjectPosition(a)});else if(c&&c>1){if(c>0)for(var e=d.slice(),f=0;f<d.length;f++){var g=Phaser.Math.removeRandom(e);if(updateSingleObjectPosition(g),f===c-1)break}}else{var h=Phaser.Math.getRandom(d);updateSingleObjectPosition(h)}}}function tryGetNearbyLocation(a,b){var c=getFreeAdjacentLocations(a,b);return c.length>0?Phaser.Math.getRandom(c):(c=getFreeAdjacentDiagonalLocations(a,b),c.length>0?Phaser.Math.getRandom(c):findEmptyGridLocation())}function getFreeAdjacentLocations(a,b){var c=[];return a-gridSize>=leftLimitX+gridSize&&!hasShapeAtXY(a-gridSize,b)&&c.push({x:a-gridSize,y:b}),rightLimitX-gridSize>=a+gridSize&&!hasShapeAtXY(a+gridSize,b)&&c.push({x:a+gridSize,y:b}),b-gridSize>=topLimitY+gridSize&&!hasShapeAtXY(a,b-gridSize)&&c.push({x:a,y:b-gridSize}),bottomLimitY-gridSize>=b+gridSize&&!hasShapeAtXY(a,b+gridSize)&&c.push({x:a,y:b+gridSize}),c}function getFreeAdjacentDiagonalLocations(a,b){var c=[];return a-gridSize>=leftLimitX+gridSize&&b-gridSize>=topLimitY+gridSize&&!hasShapeAtXY(a-gridSize,b-gridSize)&&c.push({x:a-gridSize,y:b-gridSize}),rightLimitX-gridSize>=a+gridSize&&bottomLimitY-gridSize>=b+gridSize&&!hasShapeAtXY(a+gridSize,b+gridSize)&&c.push({x:a+gridSize,y:b+gridSize}),a-gridSize>=leftLimitX+gridSize&&bottomLimitY-gridSize>=b+gridSize&&!hasShapeAtXY(a-gridSize,b+gridSize)&&c.push({x:a-gridSize,y:b+gridSize}),rightLimitX-gridSize>=a+gridSize&&b-gridSize>=topLimitY+gridSize&&!hasShapeAtXY(a+gridSize,b-gridSize)&&c.push({x:a+gridSize,y:b-gridSize}),c}function findEmptyGridLocation(){for(var a,b,c;c||null==a;)a=(Math.floor(Math.random()*numBlocksHorizontal)+1)*gridSize+leftLimitX,b=(Math.floor(Math.random()*numBlocksVertical)+1)*gridSize+topLimitY,c=hasShapeAt({x:a,y:b});return{x:a,y:b}}function scrambleAllObjects(){allGridObjectsArr.forEach(function(a){var b=findEmptyGridLocation();a.x=b.x,a.y=b.y})}function resetObjectPositions(a){a.forEach(function(a){var b=findEmptyGridLocation();console.log("resetObjectPositions: b.x="+a.x+", b.y="+a.y+", point.x="+b.x+", point.y="+b.y),a.scale.setTo(1,1),game.add.tween(a).to({alpha:0},500,Phaser.Easing.Linear.None,!0).to({x:b.x,y:b.y},1,Phaser.Easing.Linear.None,!0).to({alpha:1},500,Phaser.Easing.Linear.None,!0,500)})}function stringForDir(a){return a?a.isUp?"direction isUp":a.isDown?"direction isDown":a.isLeft?"direction isLeft":a.isRight?"direction isRight":void 0:"direction NONE"}function setTextCenter(a,b,c,d){a.originalXY||(a.originalXY={},a.originalXY.x=a.x,a.originalXY.y=a.y),a.setText(b),a.updateTransform(),(c||null==c)&&(a.position.x=a.originalXY.x-a.textWidth/2),d&&(a.position.y=a.originalXY.y-a.textHeight/2)}function setTextRight(a,b){a.originalXY||(a.originalXY={},a.originalXY.x=a.x,a.originalXY.y=a.y),a.setText(b),a.updateTransform(),a.position.x=a.originalXY.x-a.textWidth}function getShooterAngle(){return shooter1.angle}function setShooterAngle(a){shooter1.angle=a}function createSpritesheetPrize10Points(){var a=gridSize,b=gridSize,c=prizeWidth,d=prizeWidth,e=game.add.bitmapData(4*a,b),f=e.context;return f.fillStyle="#2E8B57",f.translate(a/2,b/2),f.fillRect(-c/2,-d/2,c,d),f.translate(a,0),f.fillStyle="#2E8B57",f.fillRect(-c/2,-d/2,c,d),f.strokeStyle="#FFFFFF",f.lineWidth=5,f.translate(a,0),f.fillStyle="#2E8B57",f.fillRect(-c/2,-d/2,c,d),f.strokeStyle="#FFFFFF",f.lineWidth=5,f.strokeRect(-c/2-10,-c/2-10,c+20,c+20),f.translate(a,0),f.fillStyle="#2E8B57",f.fillRect(-c/2,-d/2,c,d),f.strokeStyle="#FFFFFF",f.lineWidth=5,f.strokeRect(-c/2-15,-c/2-15,c+30,c+30),e.canvas.toDataURL()}function createSpritesheetPrize10Seconds(){var a=gridSize,b=gridSize,c=prizeWidth,d=prizeWidth,e=game.add.bitmapData(4*a,b),f=e.context;return f.fillStyle="#2E8B57",f.translate(a/2,b/2),f.fillRect(-c/2,-d/2,c,d),f.fillStyle="#FFFFFF",f.fillRect(-c/2,-d/2,c/2,d),f.translate(a,0),f.fillStyle="#2E8B57",f.fillRect(-c/2,-d/2,c,d),f.fillStyle="#FFFFFF",f.fillRect(-c/2,-d/2,c/2,d),f.strokeStyle="#FFFFFF",f.lineWidth=5,f.translate(a,0),f.fillStyle="#2E8B57",f.fillRect(-c/2,-d/2,c,d),f.fillStyle="#FFFFFF",f.fillRect(-c/2,-d/2,c/2,d),f.strokeStyle="#FFFFFF",f.lineWidth=5,f.strokeRect(-c/2-10,-c/2-10,c+20,c+20),f.translate(a,0),f.fillStyle="#2E8B57",f.fillRect(-c/2,-d/2,c,d),f.fillStyle="#FFFFFF",f.fillRect(-c/2,-d/2,c/2,d),f.strokeStyle="#FFFFFF",f.lineWidth=5,f.strokeRect(-c/2-15,-c/2-15,c+30,c+30),e.canvas.toDataURL()}function createSpritesheetPrizeUnlockChallenge1(){var a=gridSize,b=gridSize,c=prizeWidth,d=prizeWidth,e=game.add.bitmapData(6*a,b),f=e.context;return f.fillStyle="#B22222",f.translate(a/2,b/2),f.fillRect(-c/2,-d/2,c,d),f.translate(a,0),f.fillStyle="#B22222",f.fillRect(-c/2,-d/2,c,d),f.translate(a,0),f.fillStyle="#B22222",f.fillRect(-c/2,-d/2,c,d),f.translate(a,0),f.fillStyle="#FF0000",f.fillRect(-c/2,-d/2,c,d),f.translate(a,0),f.fillStyle="#B22222",f.fillRect(-c/2,-d/2,c,d),f.translate(a,0),f.fillStyle="#FF0000",f.fillRect(-c/2,-d/2,c,d),e.canvas.toDataURL()}function timeToShowRedBoxesAfterGameStart(){return timeToShowRedBoxes()}function timeToShowRedBoxes(){return game.rnd.integerInRange(2e4,3e4)}function showRedBoxPrizes(){if(isShowingRedBoxes())return void console.log("showRedBoxPrizes: already showing boxes so ignore request to show them now");var a=3,b=0;redBoxGroup.forEach(function(c){if(!(b>=a)){b+=1;var d=findEmptyGridLocation();c.alpha=0,c.scale.setTo(6,6),c.wasHit=!0,c.reset(d.x,d.y),game.add.tween(c).to({alpha:1},500,Phaser.Easing.None,!0),game.add.tween(c.scale).to({x:1,y:1},500,Phaser.Easing.None,!0).onComplete.add(function(){c.wasHit=!1,c.alpha=1,c.play("basic")})}},this)}function hideRedBoxPrizes(){redBoxArr.forEach(function(a){console.log("hideRedBoxPrizes: p.shapeId="+a.shapeId),a.wasHit=!0,a.alive=!1,game.add.tween(a).to({alpha:0},500,Phaser.Easing.None,!0).onComplete.add(function(){a.wasHit=!1,a.kill(),console.log("hideRedBoxPrizes: onComplete p.shapeId="+a.shapeId)})})}function isShowingRedBoxes(){return redBoxGroup.countLiving()>0?!0:!1}function laserHitAllRedBoxes(){totalPrizeHits+=100,setTextRight(scoreText,totalPrizeHits.toString()),savedGameTime=game.time.now,removeAndKillAllTimeBombEvents(),reflectorGroup1.forEachAlive(function(a){a.alive=!1,game.add.tween(a.scale).to({x:0,y:0},500,Phaser.Easing.Linear.None,!0).yoyo(!0).repeat(3).onComplete.add(function(){})},this),prizeGroup.forEachAlive(function(a){a.alive=!1,game.add.tween(a.scale).to({x:0,y:0},500,Phaser.Easing.Linear.None,!0).yoyo(!0).repeat(3).onComplete.add(function(){})},this),game.time.events.add(1500,function(){hideRedBoxPrizes(),timeMarkerShowRedBoxes=game.time.now+timeToShowRedBoxes(),showBonusInfo("+100 POINTS!",3e3),continueRegularGamePlay()},this)}function shuffleAllReflectors(){savedGameTime=game.time.now,allGridObjectsArr.forEach(function(a){game.add.tween(a.scale).to({x:0,y:0},500,Phaser.Easing.Linear.None,!0).onComplete.add(function(){scrambleAllObjects(),game.add.tween(a.scale).to({x:1,y:1},500,Phaser.Easing.Linear.None,!0).onComplete.add(function(){savedGameTime=0})})},this)}function startupSequenceAllReflectors(){savedGameTime=game.time.now,allGridObjectsArr.forEach(function(a){a.alpha=0,a.scale.setTo(6,6),game.add.tween(a).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),game.add.tween(a.scale).to({x:1,y:1},1e3,Phaser.Easing.Linear.None,!0).onComplete.add(function(){savedGameTime=0})},this)}function endingSequenceAllReflectors(){savedGameTime=game.time.now,allGridObjectsArr.forEach(function(a){game.add.tween(a).to({alpha:0},1e3,Phaser.Easing.Linear.None,!0),game.add.tween(a.scale).to({x:6,y:6},1e3,Phaser.Easing.Linear.None,!0).onComplete.add(function(){game.time.events.add(6e3,function(){a.scale.setTo(0,0),game.add.tween(a).to({alpha:1},500,Phaser.Easing.Linear.None,!0),game.add.tween(a.scale).to({x:1,y:1},500,Phaser.Easing.Back.Out,!0).onComplete.add(function(){savedGameTime=0})},this)})})}function timeSinceLastCommentOfType(a){return savedGameTimeAtLastCommentOfType[a]?game.time.now-savedGameTimeAtLastCommentOfType[a]:1e6}function showBonusInfo(a,b,c){savedGameTimeAtLastComment=game.time.now,c&&(savedGameTimeAtLastCommentOfType[c]=game.time.now),gameOver||shooterDead||3>=gameLevelTimer||(bonusInfoTween&&(bonusInfoTween.stop(),bonusInfoTween=null),setTextCenter(bonusText,a,!0,!0),bonusInfoGroup.visible=!0,bonusInfoGroup.alpha=1,bonusInfoTween=game.add.tween(bonusInfoGroup).to({alpha:0},b?b:1e3,Phaser.Easing.Linear.None,!0),bonusInfoTween.onComplete.add(function(){bonusInfoGroup.visible=!1}))}function continueRegularGamePlay(){console.log("\n\n\n\n*******continueRegularGamePlay*********\n\n\n\n"),reflectorGroup1.forEachDead(function(a){a.visible=!0,a.alive=!0
}),prizeGroup.forEachDead(function(a){a.visible=!0,a.alive=!0}),game.time.events.add(2e3,function(){restoreTimeMarkers(),savedGameTime=0},this)}function restoreTimeMarkers(){var a=game.time.now-savedGameTime;timeMarkerMoveBlueSquares=game.time.now+a,timeMarkerMovePrizes=game.time.now+a,timeMarkerShowRedBoxes=game.time.now+a,timeMarkerHideRedBoxes=game.time.now+a,timeMarkerMoveTimeBomb=game.time.now+a,timeMarkerTweakTriangles=game.time.now+a,timeToLaunchTimeBomb=game.time.now+a}function createSpritesheetTimeBomb(){var a=gridSize,b=gridSize,c=prizeWidth,d=a/2-c/2,e="#FFD700",f="#FFFF00",g=game.add.bitmapData(8*a,b),h=g.context;return h.save(),h.translate(d,d),h.fillStyle="#2E8B57",h.fillRect(0,0,c,c),h.fillStyle="#FFFFFF",h.fillRect(0,0,c/2,c/2),h.fillRect(c/2,c/2,c/2,c/2),h.translate(a,0),h.fillStyle="#2E8B57",h.fillRect(0,0,c,c),h.fillStyle="#FFFFFF",h.fillRect(c/2,0,c/2,c/2),h.fillRect(0,c/2,c/2,c/2),h.translate(a,0),h.fillStyle="#2E8B57",h.fillRect(0,0,c,c),h.translate(a,0),h.fillStyle="#FFFFFF",h.fillRect(0,0,c,c),h.translate(a,0),h.translate(c/2,c/2),h.fillStyle=e,h.fillRect(-c/2,-c/2,c,c),h.fillStyle=f,h.fillRect(-5,-5,10,10),h.save(),h.strokeStyle=f,h.beginPath(),h.moveTo(0,-c/2-5),h.lineTo(0,0),h.moveTo(0,c/2+5),h.lineTo(0,b),h.moveTo(-c-5,0),h.lineTo(1,0),h.moveTo(c+5,0),h.lineTo(a-1,0),h.stroke(),h.restore(),h.translate(a,0),h.fillStyle=e,h.fillRect(-c/2-10,-c/2-10,c+20,c+20),h.fillStyle=f,h.fillRect(-15,-15,30,30),h.translate(a,0),h.fillStyle=e,h.fillRect(-c/2-20,-c/2-20,c+40,c+40),h.fillStyle=f,h.fillRect(-25,-25,50,50),h.translate(a,0),h.fillStyle=e,h.fillRect(-a/2,-a/2,a,a),h.fillStyle=f,h.fillRect(-40,-40,80,80),g.canvas.toDataURL()}function timeBombAliveCount(){var a=0;return timeBombArr.forEach(function(b){b.alive&&(a+=1)}),a}function timeBombAliveArr(){var a=[];return timeBombArr.forEach(function(b){b.alive&&a.push(b)}),a}function launchTimeBomb(){if(!gameOver&&!shooterDead){if(console.log("launchTimeBomb?"),timeBombGroup.countLiving()>=maxSimultaneousTimeBombs())return void console.log("too many time bombs in play based on time remaining so skip launch");console.log("********** launchTimeBomb **********");var a=timeBombGroup.getFirstDead();if(null===a)return void console.log("unable to find an available time bomb");console.log("FOUND an available time bomb!!! shapeId="+a.shapeId);var b=findEmptyGridLocation();a.alpha=0,a.scale.setTo(6,6),a.wasHit=!0,a.reset(b.x,b.y),game.add.tween(a).to({alpha:1},500,Phaser.Easing.None,!0),game.add.tween(a.scale).to({x:1,y:1},500,Phaser.Easing.None,!0).onComplete.add(function(){a.wasHit=!1}),audioTimeBombLaunched.play(),a.play("arm1"),timeBombGroup.countLiving()>=4&&100>gameLevelTimer&&showBonusInfo("Time Bomb ALERT!",2e3),setTimeBombEvent(a,"arm1")}}function maxSimultaneousTimeBombs(){return 25>gameLevelTimer?1:50>gameLevelTimer?2:100>gameLevelTimer?4:150>gameLevelTimer?6:175>gameLevelTimer?8:10}function timeBombIntervalNextBombLaunch(){return game.rnd.integerInRange(1e3,15e3)}function destroyedTimeBomb(a){removeTimeBombEvent(a),a.kill()}function fadeOutAllTimeBombs(){game.add.tween(timeBombGroup).to({alpha:0},1e3,Phaser.Easing.None,!0).onComplete.add(function(){removeAndKillAllTimeBombEvents(),timeBombGroup.alpha=1})}function removeAndKillAllTimeBombEvents(){console.log("removeAndKillAllTimeBombEvents: IN");var a,b;for(var b in timeBombTimerInfo)console.log("timeBomb.shapeId="+b),a=timeBombTimerInfo[b],a&&(console.log("about to remove time bomb event for shapeId="+b),removeTimeBombEvent(a),a.kill()),timeBombTimerInfo[b]=null;console.log("removeAndKillAllTimeBombEvents: OUT")}function removeTimeBombEvent(a){a.timeBombEvent&&("explode"!==a.timeBombEventType&&game.time.events.remove(a.timeBombEvent),a.timeBombEvent=null,a.timeBombEventType=null,timeBombTimerInfo[a.shapeId]=null,a.textMinus25Sprite=null)}function setTimeBombEvent(a,b){removeTimeBombEvent(a);var c;c="arm1"===b?15:"arm2"===b?5:"arm3"===b?2:2,a.timeBombEvent=game.time.events.add(Phaser.Timer.SECOND*c,function(){timeBombEventCB(a,b)},this),a.timeBombEventType=b,timeBombTimerInfo[a.shapeId]=a,console.log("timeBomb.shapeId="+a.shapeId+", gameLevelTimer="+gameLevelTimer+",  eventType="+b)}function timeBombEventCB(a,b){if(a.timeBombEvent=null,"arm1"===b)a.play("arm2"),setTimeBombEvent(a,"arm2");else if("arm2"===b)a.play("arm3"),audioTimeBombArm3.play(),setTimeBombEvent(a,"arm3");else if("arm3"===b){if(a.wasHit)return void removeTimeBombEvent(a);a.wasHit=!0,gameLevelTimer-=25,0>gameLevelTimer&&(gameLevelTimer=0),a.play("explode"),audioTimeBombExplode.play(),setTimeBombEvent(a,"explode")}else timeBombExplodeCallback(a)}function timeBombExplodeCallback(a){a.timeBombEvent=null,removeTimeBombEvent(a);var b=timeBombTextGroup.getFirstDead();b.alpha=1,b.reset(a.x,a.y),a.textMinus25Sprite=b,game.add.tween(a).to({alpha:0},1e3,Phaser.Easing.Linear.None,!0).onComplete.add(function(){a.textMinus25Sprite&&(a.textMinus25Sprite.kill(),a.textMinus25Sprite=null),a.kill()})}function resetGamePlayStats(){savedGameTimeAtLastRestartLevel=game.time.now,savedGameTimeAtLastPrizeHit=0,savedGameTimeAtLastLaserFiring=0,savedPrizeHitCountPerShotArr=[],savedPrizeHitScorePerSuccessfulShotArr=[]}function avgHitCount(a){if(0===savedPrizeHitCountPerShotArr.length)return 0;for(var b=0,c=0,d=savedPrizeHitCountPerShotArr.length-1;d>=0&&(b+=savedPrizeHitCountPerShotArr[d],c+=1,!(c>=a));d--);return b/c}function avgHitScore(a){if(0===savedPrizeHitScorePerSuccessfulShotArr.length)return 0;for(var b=0,c=0,d=savedPrizeHitScorePerSuccessfulShotArr.length-1;d>=0&&(b+=savedPrizeHitScorePerSuccessfulShotArr[d],c+=1,!(c>=a));d--);return b/c}function removeActiveTimers(){game.time.events.removeAll()}var pixelRatio=window.devicePixelRatio,w=window.innerWidth;h=window.innerHeight;var lw,lh;h>w?(lw=h,lh=w):(lw=w,lh=h);var aspectRatioDevice=lw/lh;const SAFE_ZONE_WIDTH=1200,SAFE_ZONE_HEIGHT=900;var aspectRatioSafeZone=1.3333333333333333,extraWidth=0,extraHeight=0;aspectRatioDevice>aspectRatioSafeZone?extraWidth=aspectRatioDevice*SAFE_ZONE_HEIGHT-SAFE_ZONE_WIDTH:extraHeight=SAFE_ZONE_WIDTH/aspectRatioDevice-SAFE_ZONE_HEIGHT;var game=new Phaser.Game(SAFE_ZONE_WIDTH+extraWidth,SAFE_ZONE_HEIGHT+extraHeight,Phaser.CANVAS,"game_div"),game_state={},debug=0,nextUniqueShapeId=0,gridSize=100,halfGridSize=gridSize/2,shapeScale=1,shapeWidth=100,laserWidth=10,laserTrailWidth=5,prizeWidth=34,laserPathId=0,laserTrailTween,numBlocksVertical,numBlocksHorizontal,gameLevelTimerEvent,hideIntroInfoTimer,introInfoGroup,introText,gameplayObjectsGroup,fireButtonSprite,gameOverlayTextGroup,gameOverlayText,gameHelpButton,gameStartingText,timeMarkerUpdateBgTextGroup=0,timeMarkerMoveBlueSquares=0,timeMarkerMovePrizes=0,timeMarkerMoveTimeBomb=0,timeMarkerTweakTriangles=0,timeMarkerGameOver=0,timeMarkerShowRedBoxes=0,timeMarkerHideRedBoxes=0,timeMarkerShuffleBlueReflectors=0,timeMarkerShuffleAllReflectors=0,timeMarkerCheckIfLaserFiredRecently=0,maxGameLevelTime=99,maxHealthShooter=5,timerTextTween=null,extraGameTimePerPrize=1,gameLevelTimer,gameOver=!0,shooterDead=!0,boxReflector1,triangleReflector1,shooter1,balls,blocker1,laserLayerBM1,laserSprite1,laserTrailBM,laserTrailSprite,laserTextureSprite1,laserLayerTexture1,laserLayerTexture1sprite,prettyBackgroundLayer1,reflectorGroup1,blankSpaceBufferX=gridSize,blankSpaceBufferY=gridSize,cursors,laserFiring=!1,saveShooterVelocityX=0,saveShooterVelocityY=0,laserTimerEvent,prizeHitEvent,defShooterVelocity=200,shooterAcceleration=300,rightLimitX,topLimitY,bottomLimitY,leftLimitX,timeMarkerReorient=0,totalLaserBounces=0,totalPrizeHits=0,totalHealthShooter,scoreText,healthText,timerText,finalScoreText,shooterXYText,bgTextGroup,boxReflectorArr,prizeGroupArr,basicPrizeGroupArr,triangleGroupArr,allGridObjectsArr,shapeNameArr,prizeHitTweenArr,timeToLaunchTimeBomb,timeBombGroup,timeBombArr=[],specialPrizesArr=[],timeBombTextGroup,timeBombTimerInfo={},redBoxGroup,redBoxArr=[],stopLaserFiringTimerHandle,savedGameTime=0,savedGameTimeAtLastRestartLevel=0,savedGameTimeAtLastPrizeHit=0,savedGameTimeAtLastLaserFiring=0,savedGameTimeAtLastComment=0,savedGameTimeAtLastCommentOfType={},savedPrizeHitCountPerShotArr=[],savedPrizeHitScorePerSuccessfulShotArr=[],msgDieHardArr=["That's Unfortunate!","You Can't Win Them All!","Ouch!!!","Oh Well!"],msgDieEasyArr=["Try Harder!","Were You Even Looking?","Come On!","Are You Sleeping OK?","Don't You Care?"],msgDieEasyWithPrize=["Are You Distracted?","Look Beyond Your Target!","Be Careful!"],msgDieEasyWithTimeBomb=["You Meant That?","Sacrificed A Life!","So Sad!"],msgDie1BounceWithPrizeArr=["Didn't You See That?","Be More Careful!","You're Silly!","Was It Worth It?"],msgDie1BounceWithoutPrizeArr=["You Can Do Better!","Look Further Ahead!","Don't Be Silly!"],msgEasyLowHits=["Go For More!","Go Big Or Go Home!","Little More Effort!","Why Not Be Daring?","Take A Risk!"],msgRiskyGood=["I Like!","Interesting!","Bravo!","Pretty Good!","Good Stuff!"],msg2BouncesOkay=["That Was O.K.","Not Bad, My Friend","You Will Do Well","I'm Liking Your Style.","I See Skill"],msgNoShotsRecently=["I'm Waiting...","Be Bolder, Hmm?","Don't Be Afraid, Shoot!","Don't Worry...","Relax But Act!","Fire That Laser!","Don't Just Observe","Take Action.","Don't Be So Passive.","Is There A Pattern?"],msgDieAfterNoShotsRecently=["Sorry!!!","Oh Well...","That Can Happen...","Watchout Next Time!"],msgDieAfterRiskyGood=["Good Effort!","Stay Sharp!","It's Tough I Know."],msgDieAfter2BouncesOkay=["Life Is Unpredictable...","Keep Trying!"],msgShootingNoHits=["Having Fun?","Cool Your Jets!","Don't Waste Laser Power!","Relax A Bit!","You Like That Laser?","Calm Down, My Friend","Try Harder, Won't You?"];window.addEventListener("resize",function(){resizeGame()});var resizeGame=function(){game.scale.setShowAll(),game.scale.refresh()};game_state.main=function(){},game_state.main.prototype={preload:function(){game.load.spritesheet("boxReflector1","assets/squareBlueSpritesheet.png",100,100),game.load.image("triangleReflector1","assets/triangleWhite1_0.png"),game.load.image("blocker1","assets/square1.png"),game.load.image("shooter1","assets/triangleYellow1_0.png"),game.load.image("redBall","assets/redBall.png"),game.load.image("laser1","assets/laserTexture1.png"),game.load.image("greenBox","assets/greenBox.png"),game.load.image("textMinus25","assets/textMinus25.png"),game.load.spritesheet("fireButton","assets/buttons/FireButton2Frames.png",200,200),game.load.spritesheet("helpButton","assets/buttons/HelpButtonFrames.png",100,100),game.load.spritesheet("timeBomb",createSpritesheetTimeBomb(),gridSize,gridSize),game.load.spritesheet("greenBox10",createSpritesheetPrize10Points(),gridSize,gridSize),game.load.spritesheet("greenBox10time",createSpritesheetPrize10Seconds(),gridSize,gridSize),game.load.spritesheet("redBox",createSpritesheetPrizeUnlockChallenge1(),gridSize,gridSize),game.load.audio("sliding","assets/audio/sliding1.mp3"),game.load.audio("slidingPrize","assets/audio/sliding2.mp3"),game.load.audio("slidingTriangle","assets/audio/sliding3.mp3"),game.load.audio("laserFired","assets/audio/shield-hit.mp3"),game.load.audio("shooterDies","assets/audio/dramatic-fall-and-crash.mp3"),game.load.audio("prizeHit","assets/audio/button-select.mp3"),game.load.audio("gameStart","assets/audio/start-game.mp3"),game.load.audio("gameOver","assets/audio/game-over.mp3"),game.load.audio("timeBombExplode","assets/audio/Randomize136.mp3"),game.load.audio("timeBombLaunched","assets/audio/Powerup19.mp3"),game.load.audio("timeBombArm3","assets/audio/Pickup_Coin34.mp3"),game.load.audio("redBoxesHit","assets/audio/Pickup_Coin60b.mp3"),game.load.bitmapFont("pressStart2P","assets/fonts/Press_Start_2P/font.png","assets/fonts/Press_Start_2P/font.xml")},create:function(){game.physics.startSystem(Phaser.Physics.ARCADE),gameOver=!0,this.game.onPause.add(gamePaused,this),this.game.onResume.add(gameResumed,this),game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.setShowAll(),game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVeritcally=!0,game.scale.refresh(),numBlocksVertical=Math.floor(SAFE_ZONE_HEIGHT/gridSize)-2,numBlocksHorizontal=Math.floor(SAFE_ZONE_WIDTH/gridSize)-3,rightLimitX=SAFE_ZONE_WIDTH+extraWidth/2-halfGridSize-gridSize,topLimitY=halfGridSize+extraHeight/2,bottomLimitY=SAFE_ZONE_HEIGHT+extraHeight/2-halfGridSize,leftLimitX=extraWidth/2+halfGridSize,audioSliding=game.add.audio("sliding",.25,!1),audioSlidingPrize=game.add.audio("slidingPrize",.1,!1),audioSlidingTriangle=game.add.audio("slidingTriangle",.25,!1),audioLaserFired=game.add.audio("laserFired",.75,!1),audioShooterDies=game.add.audio("shooterDies",1,!1),audioPrizeHit=game.add.audio("prizeHit",.75,!1),audioGameStart=game.add.audio("gameStart",.75,!1),audioGameOver=game.add.audio("gameOver",.75,!1),audioTimeBombExplode=game.add.audio("timeBombExplode",1,!1),audioTimeBombLaunched=game.add.audio("timeBombLaunched",.5,!1),audioTimeBombArm3=game.add.audio("timeBombArm3",.5,!1),audioRedBoxesHit=game.add.audio("redBoxesHit",.75,!1),cursors=game.input.keyboard.createCursorKeys(),shapeNameArr=["triangleReflector1","blocker1"],bgDecorationGroup1=game.add.group();for(var a=0;10>a;a++){var b=game.world.randomX-100,c=game.world.randomY,d=Phaser.Math.getRandom(shapeNameArr),e=game.add.sprite(b,c,d);game.physics.enable(e,Phaser.Physics.ARCADE),e.checkWorldBounds=!0,e.anchor.setTo(.5,.5),"triangleReflector1"==d&&(e.angle=90*Math.floor(4*Math.random()));var f=2*Math.random()+1;e.scale.setTo(f,f),e.body.velocity.x=20*f/2,e.body.velocity.y=40*f/2,e.events.onOutOfBounds.add(function(a){var b=a.scale.x;a.reset(Math.random()*game.world.width-100,-100),a.body.velocity.x=20*b/2,a.body.velocity.y=40*b/2}),bgDecorationGroup1.add(e)}bgDecorationGroup1.alpha=.1,allGridObjectsArr=[],reflectorGroup1=game.add.group(),triangleGroupArr=[];for(var a=0;15>a;a++){var g=createGameElement("triangleReflector1",!0);reflectorGroup1.add(g),g.inputEnabled=!0,g.input.enableDrag(),g.events.onDragStart.add(function(a){a.saveShapeOriginalPositionX=a.x,a.saveShapeOriginalPositionY=a.y,a.isReflectorBeingDragged=!0}),g.events.onDragStop.add(fixSnapLocationReflector),g.gameTimeOfLastManualMove=0,triangleGroupArr.push(g),allGridObjectsArr.push(g)}boxReflectorArr=[];for(var a=0;5>a;a++){var g=createGameElement("boxReflector1",!1,0);reflectorGroup1.add(g),g.inputEnabled=!0,g.events.onInputDown.add(clickOnBoxReflectorListener,this),g.animations.add("safeMode",[2,1],1,!1),g.animations.add("flashRed",[3,4],4,!0),g.events.onAnimationComplete.add(function(a){a.frame=0},g),g.frame=0,boxReflectorArr.push(g),allGridObjectsArr.push(g)}for(var a=0;0>a;a++){var g=reflectorGroup1.add(createGameElement("blocker1"));allGridObjectsArr.push(g)}prizeGroupArr=[],basicPrizeGroupArr=[],prizeGroup=game.add.group();for(var a=0;10>a;a++){var g;0===a?(g=prizeGroup.add(createGameElement("greenBox10")),g.animations.add("basic",null,1,!0),g.play("basic"),g.prizePoints=10,g.timeMarkerMove=game.time.now+5e3*Math.random()+1e3,specialPrizesArr.push(g)):1===a?(g=prizeGroup.add(createGameElement("greenBox10time")),g.animations.add("basic",null,1,!0),g.play("basic"),g.prizePoints=0,g.prizeTimeOffset=10,g.timeMarkerMove=game.time.now+5e3*Math.random()+1e3,specialPrizesArr.push(g)):(g=prizeGroup.add(createGameElement("greenBox")),g.prizePoints=1,basicPrizeGroupArr.push(g)),g.wasHit=!1,prizeGroupArr.push(g),allGridObjectsArr.push(g)}prizeHitTweenArr=[],redBoxGroup=game.add.group();for(var a=0;3>a;a++){var g=createGameElement("redBox").kill();g.animations.add("basic",null,4,!0),g.prizePoints=1,redBoxGroup.add(g),redBoxArr.push(g),allGridObjectsArr.push(g)}timeMarkerShowRedBoxes=game.time.now+3e4,timeBombGroup=game.add.group(),timeBombTextGroup=game.add.group();for(var a=0;10>a;a++){timeBombTextGroup.add(createGameElement("textMinus25")).kill();var g=timeBombGroup.add(createGameElement("timeBomb"));g.kill(),g.prizePoints=1,g.animations.add("arm1",[0,1],1,!0),g.animations.add("arm2",[0,1],4,!0),g.animations.add("arm3",[2,3],8,!0),g.animations.add("explode",[4,5,6,7,6,7,6,7],4,!1),timeBombArr.push(g),allGridObjectsArr.push(g)}game.input.onDown.add(clickListener),fireButton=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),fireButton.onDown.add(fireButtonPressed),fireButton.onUp.add(fireButtonReleased),moveLeftKey=game.input.keyboard.addKey(Phaser.Keyboard.A),moveRightKey=game.input.keyboard.addKey(Phaser.Keyboard.D),moveUpKey=game.input.keyboard.addKey(Phaser.Keyboard.W),moveDownKey=game.input.keyboard.addKey(Phaser.Keyboard.S),game.input.keyboard.addKey(Phaser.Keyboard.BACKWARD_SLASH).onDown.add(fullscreenKeyPressed),game.input.keyboard.addKey(Phaser.Keyboard.ZERO).onDown.add(function(){scrambleAllObjects()}),laserTrailBM=game.add.bitmapData(game.world.width,game.world.height),laserTrailSprite=game.add.sprite(0,0,laserTrailBM),laserTrailSprite.visible=!1,laserLayerBM1=game.add.bitmapData(game.world.width,game.world.height),laserLayerSprite1=game.add.sprite(0,0,laserLayerBM1),laserLayerSprite1.visible=!1,fireButtonSprite=game.add.button(game.world.width-200,game.world.height-200,"fireButton",null,this,0,0,1,0),fireButtonSprite.onInputDown.add(fireButtonPressed),fireButtonSprite.onInputUp.add(fireButtonReleased),shooter1=game.add.sprite(game.world.centerX,halfGridSize,"shooter1"),game.physics.enable(shooter1,Phaser.Physics.ARCADE),shooter1.anchor.setTo(.5,.5),shooter1.visible=!1,gameplayObjectsGroup=game.add.group(),gameplayObjectsGroup.visible=!1,1!=shapeScale&&(allGridObjectsArr.forEach(function(a){a.scale.setTo(shapeScale,shapeScale)}),shooter1.scale.setTo(shapeScale,shapeScale));finalScoreText=game.add.text(game.world.centerX,-500,"",{font:"600px Arial",fill:"#258acc",align:"center"}),finalScoreText.anchor.set(.5,.5),finalScoreText.align="center",finalScoreText.visible=!1,gameOverlayTextGroup=game.add.group(),gameOverlayText=game.add.bitmapText(game.world.centerX,200,"pressStart2P","",50),gameOverlayText.align="center",gameOverlayTextGroup.add(gameOverlayText),gameHelpButton=game.add.button(game.world.width-100,game.world.height-300,"helpButton",null,this,0,0,2,0,gameOverlayTextGroup),gameHelpButton.onInputDown.add(helpButtonCallback),bonusInfoGroup=game.add.group(),bonusText=game.add.bitmapText(game.world.centerX,game.world.centerY,"pressStart2P","",50),bonusText.align="center",bonusInfoGroup.add(bonusText),bonusInfoGroup.visible=!1,gameStartingText=game.add.bitmapText(game.world.centerX,game.world.centerY,"pressStart2P","",50),gameStartingText.align="center",scoreText=game.add.bitmapText(game.world.width-10,50,"pressStart2P","",50),scoreText.align="right",healthText=game.add.bitmapText(game.world.width-10,150,"pressStart2P","",50),healthText.align="right",timerText=game.add.bitmapText(game.world.width-10,250,"pressStart2P","",50),timerText.align="right",introInfoGroup=game.add.group(),introInfoGroup.visible=!1;var h=game.add.graphics(0,0);introInfoGroup.add(h),h.beginFill("0x000000",.7),h.drawRect(0,0,game.width,game.height);var i=game.add.sprite(halfGridSize,game.world.height-3*halfGridSize,"greenBox");i.anchor.setTo(.5,.5),i.scale.setTo(1,1),introInfoGroup.add(i);var j=game.add.sprite(game.world.centerX,game.world.height-halfGridSize,"greenBox");j.anchor.setTo(.5,.5),j.scale.setTo(1,1),introInfoGroup.add(j);var k=game.add.sprite(game.world.width-halfGridSize,5*halfGridSize,"greenBox");k.anchor.setTo(.5,.5),k.scale.setTo(1,1),introInfoGroup.add(k),h.lineStyle(10,16711680,1),h.moveTo(halfGridSize,halfGridSize),h.lineTo(game.world.width-halfGridSize,halfGridSize),h.lineTo(game.world.width-halfGridSize,game.world.height-halfGridSize),h.lineTo(halfGridSize,game.world.height-halfGridSize),h.lineTo(halfGridSize,halfGridSize+3*gridSize);var l=game.add.sprite(halfGridSize,halfGridSize,"shooter1");l.anchor.setTo(.5,.5),introInfoGroup.add(l);var m=game.add.sprite(game.world.width-halfGridSize,halfGridSize,"triangleReflector1");m.anchor.setTo(.5,.5),m.angle=180,introInfoGroup.add(m);var n=game.add.sprite(game.world.width-halfGridSize,game.world.height-halfGridSize,"triangleReflector1");n.anchor.setTo(.5,.5),introInfoGroup.add(n),n.angle=270;var o=game.add.sprite(halfGridSize,game.world.height-halfGridSize,"triangleReflector1");o.anchor.setTo(.5,.5),introInfoGroup.add(o);var p=game.add.sprite(halfGridSize,3*gridSize+halfGridSize,"blocker1");p.anchor.setTo(.5,.5),introInfoGroup.add(p);var q=game.add.sprite(halfGridSize,2*gridSize+halfGridSize,"boxReflector1");q.anchor.setTo(.5,.5),introInfoGroup.add(q);introText=game.add.bitmapText(game.world.centerX,game.world.centerY,"pressStart2P","",20),introText.align="left",introInfoGroup.add(introText),game.time.events.add(2*Phaser.Timer.SECOND,function(){setTextCenter(introText,"Welcome to LAZOR REFLEKTOR!!!\n\nThe object of the game is to fire your laser\nand try to hit the green prize boxes without\nhitting a blue reflector box because they\nwill bounce the laser back along its path and\nkill you. The triangle shaped reflectors will\nbounce the laser and change its path.\n\nYou can temporarily neutralize a blue reflector\nbox by touching it (or clicking it). A laser \nbeam that hits a neutralized box will not reflect\nbackwards and so is safe to hit (but only very \nbriefly).\n\nYou may drag the triangle reflectors around\nand you may rotate them by clicking on them.\n\nEach prize hit will add to your score and will \nadd some game time. The more times the \nlaser is bounced around by the triangle \nreflectors, the more points per prize hit. But \nthe more likely you will accidentally hit a blue \nreflector and so be killed.\n\nThe game is over when all 5 player lives are\nlost or when you run out of time, whichever \ncomes first.\n\nThere is more but you'll have to figure it out\non your own.\n\nFeel free to leave comments or suggestions at\nlazor.reflektor@gmail.com\n",!0,!0),setTextCenter(gameOverlayText,"LAZOR REFLEKTOR!!!\n\n\n\nGAME OVER\n\ntouch screen\nto start")},this)},update:function(){if(reorientShooterAsNecessary(),0===savedGameTime){if(timeMarkerShuffleAllReflectors>0&&game.time.now>timeMarkerShuffleAllReflectors)return timeMarkerShuffleAllReflectors=game.time.now+6e4,void shuffleAllReflectors();game.time.now>timeMarkerShuffleBlueReflectors?(updateObjectPositions(boxReflectorArr,!0),timeMarkerShuffleBlueReflectors=game.time.now+5e3*Math.random()+25e3):game.time.now>timeMarkerMoveBlueSquares&&(updateObjectPositions(boxReflectorArr),timeMarkerMoveBlueSquares=game.time.now+5e3*Math.random()+5e3),game.time.now>timeMarkerMovePrizes&&(updateObjectPositions(basicPrizeGroupArr),timeMarkerMovePrizes=game.time.now+5e3*Math.random()+5e3),!isShowingRedBoxes()&&game.time.now>timeMarkerShowRedBoxes&&(showRedBoxPrizes(),timeMarkerHideRedBoxes=game.time.now+3e4),isShowingRedBoxes()&&game.time.now>timeMarkerHideRedBoxes&&(hideRedBoxPrizes(),timeMarkerShowRedBoxes=game.time.now+timeToShowRedBoxes()),timeBombAliveCount()>0&&game.time.now>timeMarkerMoveTimeBomb&&(updateObjectPositions(timeBombArr,!0),timeMarkerMoveTimeBomb=game.time.now+2e3),specialPrizesArr.length>0&&specialPrizesArr.forEach(function(a){game.time.now>a.timeMarkerMove&&(updateSingleObjectPosition(a),a.timeMarkerMove=game.time.now+5e3*Math.random()+1e3)}),game.time.now>timeMarkerTweakTriangles&&(updateObjectPositions(triangleGroupArr,!1,game.rnd.integerInRange(1,5)),timeMarkerTweakTriangles=game.time.now+5e3*Math.random()+2e3),game.time.now>timeToLaunchTimeBomb&&(launchTimeBomb(),timeToLaunchTimeBomb=game.time.now+timeBombIntervalNextBombLaunch()),0!==timeMarkerCheckIfLaserFiredRecently&&game.time.now>timeMarkerCheckIfLaserFiredRecently&&(timeMarkerCheckIfLaserFiredRecently=game.time.now+3e3*Math.random()+3e3,showBonusInfo(game.rnd.pick(msgNoShotsRecently),2e3))}},render:function(){20140401===debug&&(game.debug.spriteInfo(shooter1,10,180),game.debug.text("shooter1.body.x="+shooter1.body.x+", y="+shooter1.body.y,10,100),game.debug.text("shooter1.body.velocity.x="+shooter1.body.velocity.x+", y="+shooter1.body.velocity.y,10,120),game.debug.text("shooter1.body.acceleration.x="+shooter1.body.acceleration.x+", y="+shooter1.body.acceleration.y,10,140)),20140402===debug&&game.debug.text("game.time.now="+game.time.now+", timeToLaunchTimeBomb="+timeToLaunchTimeBomb,10,100)}};var bonusInfoTween=null;game.state.add("main",game_state.main),game.state.start("main");