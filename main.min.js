function gamePaused(){}function gameResumed(){}function helpButtonCallback(){console.log("helpButtonCallback: about to show intro info"),showIntroInfo(),console.log("helpButtonCallback: OUT")}function updateGameLevelTimer(){gameOver||1!=debug&&(gameLevelTimer-=1,timerText.setText(gameLevelTimer.toString()),console.log("updateGameLevelTimer gameLevelTimer="+gameLevelTimer),0>=gameLevelTimer?(audioGameOver.play(),gameLevelTimeout()):10==gameLevelTimer?timerTextTween=game.add.tween(timerText).to({alpha:0},100,Phaser.Easing.Linear.None,!0).to({alpha:1},100,Phaser.Easing.Linear.None,!0,0,100,!0):gameLevelTimer>10&&null!=timerTextTween&&timerTextTween.isRunning&&(console.log("*************** stopping tween"),timerTextTween.stop()))}function rotateTriangleReflector(a,b){var c;c=b?90*Math.floor(4*Math.random()):Phaser.Math.snapToFloor(a.angle,90)+90,game.add.tween(a).to({angle:c},500,Phaser.Easing.Linear.None,!0).onComplete.add(function(){a.angle=Phaser.Math.snapToFloor(a.angle,90)},this)}function fullscreenKeyPressed(){game.stage.scale.startFullScreen()}function createGameElement(a,b,c,d){var e,f,g=findEmptyGridLocation();e=g.x,f=g.y,console.log("createGameElement: pointEmpty.x="+g.x+", pointEmpty.y="+g.y);var h=game.add.sprite(e,f,a,d);return h.shapeId=nextUniqueShapeId++,h.anchor.setTo(.5,.5),b&&(h.angle=90*Math.floor(4*Math.random())),h.body.linearDamping=.1,c&&(h.input.start(0,!0),h.input.enableDrag(),h.events.onDragStop.add(fixSnapLocationReflector),h.events.onInputDown.add(clickOnReflectorListener,this)),h.name=a,h}function fixSnapLocationReflector(a){var b=snapToShapeGrid({x:a.x,y:a.y}),c=b.x,d=b.y;console.log("\n\n\nfixSnapLocationReflector: IN reflectorSprite.shapeId="+a.shapeId+", toX="+c+", toY="+d);var e=hasShapeAtXY(c,d);e&&console.log("fixSnapLocationReflector: hasShapeAtXY(toX,toY)="+e.shapeId);var f;f=e&&e.shapeId!=a.shapeId?tryGetNearbyLocation(c,d):{x:c,y:d},a.x=f.x,a.y=f.y}function fireButtonPressed(){if(console.log("fireButtonPressed IN"),!gameOver&&shooterDead)return void console.log("fireButtonPressed: ignoring because the shooter is dead");if(gameOver||shooterDead)return game.time.now>timeMarkerGameOver?void restartGame():void console.log("fireButtonPressed: game is over or the shooter is dead so ignoring the fire button");console.log("fireButtonPressed: shooter must not be dead. shooterDead="+shooterDead),laserFiring=!0,audioLaserFired.play(),saveShooterVelocityX=shooter1.body.velocity.x,saveShooterVelocityY=shooter1.body.velocity.y,console.log("\n\n\n\n\n\n*************\nfireButtonPressed: setting saveShooterVelocityX="+saveShooterVelocityX+", shooter1.body.velocity.x="+shooter1.body.velocity.x),shooter1.body.velocity.setTo(0,0);var a=shooter1.x,b=shooter1.y,c=drawLaserFrom(a,b,shooter1.angle);if(console.log("\nfireButtonPressed: after drawLaserFrom\n\n\n"),laserLayerSprite1.visible=!0,laserLayerSprite1.alpha=1,c.isReflectingBack&&(console.log("adding timer event"),laserTimerEvent=game.time.events.loop(100,laserTimerEventCallback,this),1!=debug&&(totalHealthShooter-=1)),c.prizeArr.length>0&&(audioPrizeHit.play(),c.prizeArr.forEach(function(a){gameLevelTimer+=extraGameTimePerPrize,a.wasHit=!0,game.add.tween(a.scale).to({x:2,y:2},100,Phaser.Easing.Linear.None,!0,0,5,!0),game.add.tween(a).to({alpha:0},500,Phaser.Easing.Linear.None,!0).onComplete.add(function(){var b=findEmptyGridLocation();a.wasHit=!1,a.scale.setTo(1,1),a.x=b.x,a.y=b.y,game.add.tween(a).to({alpha:1},500,Phaser.Easing.Linear.None,!0).onComplete.add(function(){a.scale.setTo(1,1)})},this)}),totalPrizeHits+=c.hitScore),healthText.setText(totalHealthShooter.toString()),scoreText.setText(totalPrizeHits.toString()),c.isReflectingBack){var d=shooterDirection();d.isUp||d.isDown?game.add.tween(shooter1).to({x:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({x:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).onComplete.add(shooterDies,this):game.add.tween(shooter1).to({y:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"-10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).to({y:"+10"},50,Phaser.Easing.Linear.None,!0,0,0,!0).onComplete.add(shooterDies,this)}}function fireButtonReleased(){laserFiring&&(console.log("fireButtonReleased!"),laserLayerSprite1.visible=!1,laserFiring=!1,laserTimerEvent&&(console.log("removing timer event"),game.time.events.remove(laserTimerEvent),laserTimerEvent=null),gameOver||shooterDead||(console.log("fireButtonReleased: saveShooterVelocityX="+saveShooterVelocityX),null!=saveShooterVelocityX&&shooter1.body.velocity.setTo(saveShooterVelocityX,saveShooterVelocityY)))}function shooterDies(){shooterDead=!0,fireButtonReleased(),game.add.tween(shooter1).to({alpha:0},2e3,Phaser.Easing.Linear.None,!0,500),totalHealthShooter>0?(audioShooterDies.play(),game.time.events.add(3e3,restartLevel,this)):(audioShooterDies.play(),gameLevelTimeout())}function gameLevelTimeout(){gameOver=!0,shooterDead=!0,gameLevelTimerEvent&&(game.time.events.remove(gameLevelTimerEvent),gameLevelTimerEvent=null),shooter1.visible=!1,console.log("************** GAME OVER *****************");var a=totalPrizeHits+Math.floor(totalPrizeHits*totalHealthShooter/maxHealthShooter);finalScoreText.visible=!0,finalScoreText.setText(a),game.add.tween(finalScoreText).to({y:game.world.centerY},1e3,Phaser.Easing.Back.Out,!0),game.time.events.add(2*Phaser.Timer.SECOND,function(){gameOverlayTextGroup.visible=!0,gameplayObjectsGroup.visible=!1},this),timeMarkerGameOver=game.time.now+2e3}function showIntroInfo(){1!=debug&&gameOver&&(console.log("showIntroInfo: IN"),gameOverlayTextGroup.visible=!1,introInfoGroup.visible=!0,finalScoreText.visible=!1,hideIntroInfoTimer=game.time.events.add(60*Phaser.Timer.SECOND,hideIntroInfo,this))}function hideIntroInfo(){gameOver&&(console.log("hideIntroInfo: IN"),hideIntroInfoTimer&&(game.time.events.remove(hideIntroInfoTimer),hideIntroInfoTimer=!1),gameOverlayTextGroup.visible=!0,introInfoGroup.visible=!1,gameOverlayTextGroup.visible=!0)}function isShowingIntroInfo(){return introInfoGroup.visible}function restartGame(){gameOver=!1,scrambleAllObjects(),introInfoGroup.visible=!1,gameOverlayTextGroup.visible=!1,gameplayObjectsGroup.visible=!0,finalScoreText.visible=!1,finalScoreText.y=-500,finalScoreText.setText(""),totalHealthShooter=maxHealthShooter,totalPrizeHits=0,gameLevelTimer=maxGameLevelTime,healthText.setText(totalHealthShooter.toString()),scoreText.setText(totalPrizeHits.toString()),timerText.setText(gameLevelTimer.toString()),timerText.alpha=1,gameStartingText.setText("GET READY!\n\n3"),gameStartingText.visible=!0,game.time.events.add(Phaser.Timer.SECOND,function(){gameStartingText.setText("GET READY!\n\n2")},this),game.time.events.add(2*Phaser.Timer.SECOND,function(){gameStartingText.setText("GET READY!\n\n1")},this),game.time.events.add(3*Phaser.Timer.SECOND,function(){audioGameStart.play(),gameStartingText.visible=!1,restartLevel(),gameLevelTimerEvent&&game.time.events.remove(gameLevelTimerEvent),gameLevelTimerEvent=game.time.events.loop(Phaser.Timer.SECOND,updateGameLevelTimer,this),timeMarkerMoveBlueSquares=game.time.now+1e3,timeMarkerMovePrizes=game.time.now+2e3,timeMarkerTweakTriangles=game.time.now+2e3},this)}function restartLevel(){var a=[topLimitY,bottomLimitY],b=[90,270],c=[-defShooterVelocity,defShooterVelocity];saveShooterVelocityX=null,saveShooterVelocityY=null,shooterDead=!1,shooter1.visible=!0,shooter1.alpha=1,shooter1.angle=Phaser.Math.getRandom(b),shooter1.x=game.world.centerX,shooter1.y=Phaser.Math.getRandom(a),shooter1.body.angularVelocity=0,shooter1.body.acceleration.setTo(0,0),shooter1.body.velocity.setTo(0,0),shooter1.body.velocity.x=Phaser.Math.getRandom(c),healthText.setText(totalHealthShooter.toString()),scoreText.setText(totalPrizeHits.toString()),timerText.setText(gameLevelTimer.toString()),timerText.alpha=1}function laserTimerEventCallback(){laserLayerSprite1.alpha=1==laserLayerSprite1.alpha?.1:1}function drawLaserFrom(a,b){1==debug&&console.log("\n\n\n\n\n\n-----------------------------------------\ndrawLaserFrom: IN"),laserLayerBM1.clear(),laserLayerBM1.setStrokeStyle(laserWidth),laserLayerBM1.strokeStyle("#f00"),laserLayerBM1.beginPath();var c,d,e;c=a,d=b;var f=!1;laserLayerBM1.moveTo(c,d);for(var g=shooterDirection(),h=[],i=0,j=0;!e||!e.isLastSegment;)1==debug&&console.log("drawLaserFrom: in while, numLaserBounces="+i+", laserDirection="+stringForDir(g)+", lx0="+c+", ly="+d),e=calcLineSegment(g,c,d),laserLayerBM1.lineTo(e.x1,e.y1),f=e.isReflectingBack,h=h.concat(e.prizeArr),j+=e.prizeArr.length*(i+1),g=e.laserReflectionDirection,1==debug&&console.log("drawLaserFrom: in while after calcLineSegment, , laserReflectionDirection="+stringForDir(g)+", calcuatedLineSegmentInfo.x1="+e.x1+", y1="+e.y1+", isLastSegment="+e.isLastSegment),c=e.x1,d=e.y1,e.isLastSegment||(i+=1);return laserLayerBM1.stroke(),console.log("drawLaserFrom: OUT isReflectingBack="+f),{isReflectingBack:f,numLaserBounces:i,hitScore:j,prizeArr:h}}function touchListenerOnUp(){laserFiring&&fireButtonReleased()}function clickListener(){console.log("\n\nclickListener: IN***"),gameOver&&(isShowingIntroInfo()?hideIntroInfo():game.input.y<game.world.height-100&&fireButtonPressed());var a=snapToShapeGrid({x:game.input.x,y:game.input.y});console.log("clickListener: snapped to x="+a.x+", y="+a.y);var b=hasShapeAt({x:game.input.x,y:game.input.y});b&&(isShapeTriangle(b)?(console.log("clickListener: clicked on triangle"),b.angle==Phaser.Math.snapToFloor(b.angle,90)?rotateTriangleReflector(b,!1):console.log("clickListener: the triangle is rotating!!!!!!! Ignoring the click!")):"boxReflector1"==b.name&&b.play("safeMode")),console.log("clickListener: OUT\n\n\n")}function calcLineSegment(a,b,c){console.log("calcLineSegment: IN");var d={x0:b,y0:c,isReflectingBack:!1,isLastSegment:!0},e=firstSpriteHit(a,b,c);if(e){console.log("calcLineSegment: sprite found for line segment! sprite.x="+e.x+", sprite.y="+e.y+", sprite.angle="+e.angle);var f=calcHitPoint(a,e,b,c);d.x1=f.x1,d.y1=f.y1,d.isReflectingBack=f.isReflectingBack,d.isLastSegment=f.isLastSegment,d.laserReflectionDirection=f.laserReflectionDirection}else{1==debug&&console.log("calcLineSegment: no sprite collision, so go to edge of the world");var g=lineFromDirectionAndXY(a,b,c);d.x1=g.x1,d.y1=g.y1}return d.prizeArr=collectPrizesOnLine(a,d.x0,d.y0,d.x1,d.y1),1==debug&&console.log("calcLineSegment: r.prizeArr.lenth="+d.prizeArr.length),d}function collectPrizesOnLine(a,b,c,d,e){var f=[];return console.log("collectPrizesOnLine: IN"),prizeGroup.forEach(function(g){g.alive&&!g.wasHit&&isPrizeOnLine(g,a,b,c,d,e)&&(console.log("collectPrizesOnLine: found prize x="+g.x+", y="+g.y),f.push(g))}),console.log("collectPrizesOnLine: OUT  prizeArr.length="+f.length),f}function isShapeOnPath2(a,b,c,d){var e=lineFromDirectionAndXY(b,c,d);return isPrizeOrShapeOnLine(a,shapeWidth,b,c,d,e.x1,e.y1)}function isPrizeOnLine(a,b,c,d,e,f){return isPrizeOrShapeOnLine(a,prizeWidth,b,c,d,e,f,!0)}function isPrizeOrShapeOnLine(a,b,c,d,e,f,g,h){if(1==debug&&console.log("isPrizeOrShapeOnLine: obj.name="+a.name+", obj.x="+a.x+", obj.y="+a.y+", sw="+b+", d="+stringForDir(c)+", x0="+d+", y0="+e+", x1="+f+", y1="+g+", isPrizeSearch="+h),Math.abs(a.x-d)<b/2&&Math.abs(a.y-e)<b/2)return 1==debug&&console.log("isPrizeOrShapeOnLine: ignore obj"),!1;var i=d,j=e,k=laserWidth/2+b/2;if(c.isUp||c.isDown){if(isBetween(a.y,e,g,k)&&Math.abs(a.x-i)<k)return!0}else if(isBetween(a.x,d,f,k)&&Math.abs(a.y-j)<k)return!0;return!1}function isBetween(a,b,c,d){return a>b-d&&c+d>a||b+d>a&&a>c-d}function lineFromDirectionAndXY(a,b,c){var d;return d=a.isUp?{x0:b,y0:c,x1:b,y1:0}:a.isDown?{x0:b,y0:c,x1:b,y1:game.world.height}:a.isLeft?{x0:b,y0:c,x1:0,y1:c}:{x0:b,y0:c,x1:game.world.width,y1:c}}function isShapeTriangle(a){return"triangleReflector1"==a.name?!0:!1}function calcHitPoint(a,b,c,d){var e={isReflectingBack:!1,isLastSegment:!0};e.laserReflectionDirection={isUp:!1,isDown:!1,isLeft:!1,isRight:!1};var f;if(1==debug&&console.log("calcHitPoint: in"),isShapeTriangle(b)&&(1==debug&&console.log("calcHitPoint: triangle"),f=hitTriangleDiagonal(a,c,d,b),1==debug&&console.log("calcHitPoint: triangleHitDiagonalInfo.hitDiagonal="+f.hitDiagonal)),isShapeTriangle(b)&&f.hitDiagonal)1==debug&&console.log("calcHitPoint: hitDiagonal***"),e.isLastSegment=!1,e.laserReflectionDirection=f.laserReflectionDirection,e.x1=f.hitPointXY.x,e.y1=f.hitPointXY.y,1==debug&&console.log("calcHitPoint: triangle, diagonal, hitPointXY="+e.x1+"/"+e.y1);else{var g=shapeWidth/2;if(a.isDown?(e.x1=c,e.y1=b.y-g):a.isUp?(e.x1=c,e.y1=b.y+g):a.isLeft?(e.x1=b.x+g,e.y1=d):(e.x1=b.x-g,e.y1=d),"boxReflector1"==b.name){var h=b.frame,i=b.animations.getAnimation("safeMode");1==debug&&console.log("!!!!!!!******** boxReflector1 isPlaying="+i.isPlaying+", frame="+h),0!=h||i.isPlaying||(e.isReflectingBack=!0,b.play("flashRed"),game.time.events.add(1e3,function(){b.animations.getAnimation("flashRed").stop(),b.frame=0})),e.laserReflectionDirection=invertLaserDirection(a)}}return e}function invertLaserDirection(a){var b={isUp:!1,isDown:!1,isLeft:!1,isRight:!1};return a.isUp&&(b.isDown=!0),a.isDown&&(b.isUp=!0),a.isLeft&&(b.isRight=!0),a.isRight&&(b.isLeft=!0),b}function hitTriangleDiagonal(a,b,c,d){var e,f,g,h,i=!1,j={},k={isLeft:!1,isRight:!1,isUp:!1,isDown:!1},l={},m=triangleReflectDirection(d);if(a.isDown&&m.isUp?(i=!0,m.isLeft?(g=d.x-b,e=b,f=d.y+g,l.x0=1,l.y0=-1,l.x1=-1,l.y1=1,k.isLeft=!0):(g=b-d.x,e=b,f=d.y+g,l.x0=-1,l.y0=-1,l.x1=1,l.y1=1,k.isRight=!0)):a.isUp&&m.isDown?(i=!0,m.isLeft?(g=b-d.x,e=b,f=d.y+g,k.isLeft=!0,l={x0:-1,y0:-1,x1:1,y1:1}):(g=d.x-b,e=b,f=d.y+g,k.isRight=!0,l={x0:1,y0:-1,x1:-1,y1:1})):a.isLeft&&m.isRight?(i=!0,m.isUp?(h=c-d.y,e=d.x+h,f=c,k.isUp=!0,l={x0:-1,y0:-1,x1:1,y1:1}):(h=d.y-c,e=d.x+h,f=c,k.isDown=!0,l={x0:1,y0:-1,x1:-1,y1:1})):a.isRight&&m.isLeft&&(i=!0,m.isUp?(h=d.y-c,e=d.x+h,f=c,k.isUp=!0,l={x0:1,y0:-1,x1:-1,y1:1}):(h=c-d.y,e=d.x+h,f=c,k.isDown=!0,l={x0:-1,y0:-1,x1:1,y1:1})),j.hitDiagonal=i,!i)return j;var n=d.width/2;return j.laserReflectionDirection=k,j.hitPointXY={x:e,y:f},j.reflectingLineInfo={x0:l.x0*n+d.x,y0:l.y0*n+d.y,x1:l.x1*n+d.x,y1:l.y1*n+d.y},j}function triangleReflectDirection(a){var b={up:!1,down:!1,left:!1,right:!1};return 0==a.angle?(b.isUp=!0,b.isRight=!0):-90==a.angle?(b.isUp=!0,b.isLeft=!0):90==a.angle?(b.isDown=!0,b.isRight=!0):(b.isDown=!0,b.isLeft=!0),b}function firstSpriteHit(a,b,c){var d=findObjectsOnPath(a,b,c);return 0==d.length?null:d.shift()}function findObjectsOnPath(a,b,c){var d=[];1==debug&&console.log("findObjectsOnPath: IN  "+stringForDir(a)+", x0="+b+", y0="+c);for(var e=0;e<reflectorGroup1.length;e++){var f=reflectorGroup1.getAt(e);if(f.alive){if(!isShapeOnPath2(f,a,b,c))continue;d.push(f)}}return d.sort(function(b,c){return a.isDown?b.y-c.y:a.isUp?c.y-b.y:a.isRight?b.x-c.x:c.x-b.x}),d}function isShapeBelow(a,b,c){return a.y>c&&a.x==b?!0:!1}function isShapeAbove(a,b,c){return a.y<c&&a.x==b?!0:!1}function isShapeToTheRight(a,b,c){return a.x>b&&a.y==c?!0:!1}function isShapeToTheLeft(a,b,c){return a.x<b&&a.y==c?!0:!1}function isShapeOnPath(a,b,c,d){return a.isDown?isShapeBelow(b,c,d):a.isUp?isShapeAbove(b,c,d):a.isRight?isShapeToTheRight(b,c,d):isShapeToTheLeft(b,c,d)}function shooterDirection(){var a=shooter1.angle,b={};return 0==a?b.isRight=!0:-180==a?b.isLeft=!0:90==a?b.isDown=!0:b.isUp=!0,b}function clickOnReflectorListener(a){clickedOnSprite=a}function reorientShooterAsNecessary(){var a=shooterDirection(),b=!1;if(game.time.now>timeMarkerReorient){var c=Math.abs(shooter1.body.velocity.x+shooter1.body.velocity.y);if(1==debug&&console.log("reorientShooterAsNecessary: saveVelocity="+c+", velocity.x="+velocity.x+", velocity.y="+velocity.y),0==c)return void(1==debug&&console.log("reorientShooterAsNecessary: do nothing!!!"));shooter1.x>rightLimitX&&a.isDown?(b=!0,shooter1.angle=180,shooter1.body.velocity.x=0,shooter1.body.velocity.y=c,shooter1.x=rightLimitX):shooter1.y<topLimitY&&a.isLeft?(b=!0,shooter1.angle=90,shooter1.body.velocity.x=-c,shooter1.body.velocity.y=0,shooter1.y=topLimitY):shooter1.y>bottomLimitY&&a.isLeft?(b=!0,shooter1.angle=270,shooter1.body.velocity.y=0,shooter1.body.velocity.x=-c,shooter1.y=bottomLimitY):shooter1.x>rightLimitX&&a.isUp?(b=!0,shooter1.angle=180,shooter1.body.velocity.x=0,shooter1.body.velocity.y=-c,shooter1.x=rightLimitX):shooter1.x<leftLimitX&&a.isUp?(b=!0,shooter1.angle=0,shooter1.body.velocity.x=0,shooter1.body.velocity.y=-c,shooter1.x=leftLimitX):shooter1.y>bottomLimitY&&a.isRight?(b=!0,shooter1.angle=270,shooter1.body.velocity.x=c,shooter1.body.velocity.y=0,shooter1.y=bottomLimitY):shooter1.y<topLimitY&&a.isRight?(b=!0,shooter1.angle=90,shooter1.body.velocity.x=c,shooter1.body.velocity.y=0,shooter1.y=topLimitY):shooter1.x<leftLimitX&&a.isDown&&(b=!0,shooter1.angle=0,shooter1.body.velocity.x=0,shooter1.body.velocity.y=c,shooter1.x=leftLimitX)}b&&(timeMarkerReorient=game.time.now+200),a.isDown?shooter1.y=topLimitY:a.isUp?shooter1.y=bottomLimitY:shooter1.x=a.isLeft?rightLimitX:leftLimitX}function snapToShapeGrid(a){return{x:Phaser.Math.snapToFloor(a.x-extraWidth/2,gridSize)+halfGridSize+extraWidth/2,y:Phaser.Math.snapToFloor(a.y-extraHeight/2,gridSize)+halfGridSize+extraHeight/2}}function hasShapeAtXY(a,b){return hasShapeAt({x:a,y:b})}function hasShapeAt(a){for(var b=snapToShapeGrid(a),c=b.x,d=b.y,e=0;e<allGridObjectsArr.length;e++){var f=allGridObjectsArr[e];if(f.alive&&c===f.x&&d===f.y)return f}return!1}function shapeCountAtLocation(a,b){var c=findShapesAt(a,b);return c.length}function findShapesAt(a,b){var c=[];return allGridObjectsArr.forEach(function(d){d.alive&&a==d.x&&b==d.y&&c.push(d)}),c}function updateSingleObjectPosition(a){var b=getFreeAdjacentLocations(a.x,a.y);if(0!=b.length){var c=Phaser.Math.getRandom(b);game.add.tween(a).to({x:c.x,y:c.y},500,Phaser.Easing.Back.Out,!0).onComplete.add(function(){console.log("updateSingleObjectPosition: completed move, checking if need to move again");var b=shapeCountAtLocation(c.x,c.y);b>1?(console.log("updateSingleObjectPosition: moving shape again"),updateSingleObjectPosition(a)):console.log("updateSingleObjectPosition: did not need to move again")},this),isShapeTriangle(a)?(audioSlidingTriangle.play(),rotateTriangleReflector(a,!0)):"greenBox"==a.name?audioSlidingPrize.play():audioSliding.play()}}function updateObjectPositions(a){if(1!=debug){var b=Phaser.Math.getRandom(a);updateSingleObjectPosition(b)}}function tryGetNearbyLocation(a,b){var c=getFreeAdjacentLocations(a,b);return c.length>0?Phaser.Math.getRandom(c):(c=getFreeAdjacentDiagonalLocations(a,b),c.length>0?Phaser.Math.getRandom(c):findEmptyGridLocation())}function getFreeAdjacentLocations(a,b){var c=[];return a-gridSize>=leftLimitX+gridSize&&!hasShapeAtXY(a-gridSize,b)&&c.push({x:a-gridSize,y:b}),rightLimitX-gridSize>=a+gridSize&&!hasShapeAtXY(a+gridSize,b)&&c.push({x:a+gridSize,y:b}),b-gridSize>=topLimitY+gridSize&&!hasShapeAtXY(a,b-gridSize)&&c.push({x:a,y:b-gridSize}),bottomLimitY-gridSize>=b+gridSize&&!hasShapeAtXY(a,b+gridSize)&&c.push({x:a,y:b+gridSize}),c}function getFreeAdjacentDiagonalLocations(a,b){var c=[];return a-gridSize>=leftLimitX+gridSize&&b-gridSize>=topLimitY+gridSize&&!hasShapeAtXY(a-gridSize,b-gridSize)&&c.push({x:a-gridSize,y:b-gridSize}),rightLimitX-gridSize>=a+gridSize&&bottomLimitY-gridSize>=b+gridSize&&!hasShapeAtXY(a+gridSize,b+gridSize)&&c.push({x:a+gridSize,y:b+gridSize}),a-gridSize>=leftLimitX+gridSize&&bottomLimitY-gridSize>=b+gridSize&&!hasShapeAtXY(a-gridSize,b+gridSize)&&c.push({x:a-gridSize,y:b+gridSize}),rightLimitX-gridSize>=a+gridSize&&b-gridSize>=topLimitY+gridSize&&!hasShapeAtXY(a+gridSize,b-gridSize)&&c.push({x:a+gridSize,y:b-gridSize}),c}function findEmptyGridLocation(){for(var a,b,c;c||null==a;)a=(Math.floor(Math.random()*numBlocksHorizontal)+1)*gridSize+leftLimitX,b=(Math.floor(Math.random()*numBlocksVertical)+1)*gridSize+topLimitY,c=hasShapeAt({x:a,y:b});return{x:a,y:b}}function scrambleAllObjects(){allGridObjectsArr.forEach(function(a){a.alive=!1}),allGridObjectsArr.forEach(function(a){var b=findEmptyGridLocation();a.x=b.x,a.y=b.y,a.alive=!0})}function resetObjectPositions(a){a.forEach(function(a){var b=findEmptyGridLocation();console.log("resetObjectPositions: b.x="+a.x+", b.y="+a.y+", point.x="+b.x+", point.y="+b.y),a.scale.setTo(1,1),game.add.tween(a).to({alpha:0},500,Phaser.Easing.Linear.None,!0).to({x:b.x,y:b.y},1,Phaser.Easing.Linear.None,!0).to({alpha:1},500,Phaser.Easing.Linear.None,!0,500)})}function stringForDir(a){return a?a.isUp?"direction isUp":a.isDown?"direction isDown":a.isLeft?"direction isLeft":a.isRight?"direction isRight":void 0:"direction NONE"}var pixelRatio=window.devicePixelRatio,w=window.innerWidth;h=window.innerHeight;var lw,lh;h>w?(lw=h,lh=w):(lw=w,lh=h);var aspectRatioDevice=lw/lh;const SAFE_ZONE_WIDTH=1200,SAFE_ZONE_HEIGHT=900;var aspectRatioSafeZone=1.3333333333333333,extraWidth=0,extraHeight=0;aspectRatioDevice>aspectRatioSafeZone?extraWidth=aspectRatioDevice*SAFE_ZONE_HEIGHT-SAFE_ZONE_WIDTH:extraHeight=SAFE_ZONE_WIDTH/aspectRatioDevice-SAFE_ZONE_HEIGHT;var game=new Phaser.Game(SAFE_ZONE_WIDTH+extraWidth,SAFE_ZONE_HEIGHT+extraHeight,Phaser.CANVAS,"game_div"),game_state={},debug=0,nextUniqueShapeId=0,gridSize=100,halfGridSize=gridSize/2,shapeScale=1,shapeWidth=100,laserWidth=10,prizeWidth=34,numBlocksVertical,numBlocksHorizontal,gameLevelTimerEvent,hideIntroInfoTimer,introInfoGroup,introText,gameplayObjectsGroup,fireButtonSprite,gameOverlayTextGroup,gameOverlayText,gameHelpButton,gameStartingText,timeMarkerUpdateBgTextGroup=0,timeMarkerMoveBlueSquares=0,timeMarkerMovePrizes=0,timeMarkerTweakTriangles=0,timeMarkerGameOver=0,maxGameLevelTime=99,maxHealthShooter=5,timerTextTween=null,extraGameTimePerPrize=2,gameLevelTimer,gameOver=!0,shooterDead=!0,boxReflector1,triangleReflector1,shooter1,balls,blocker1,laserLayerBM1,laserSprite1,laserTextureSprite1,laserLayerTexture1,laserLayerTexture1sprite,prettyBackgroundLayer1,reflectorGroup1,blankSpaceBufferX=gridSize,blankSpaceBufferY=gridSize,cursors,clickedOnSprite,laserFiring=!1,saveShooterVelocityX=0,saveShooterVelocityY=0,laserTimerEvent,prizeHitEvent,defShooterVelocity=200,shooterAcceleration=300,rightLimitX,topLimitY,bottomLimitY,leftLimitX,timeMarkerReorient=0,totalLaserBounces=0,totalPrizeHits=0,totalHealthShooter,scoreText,healthText,timerText,finalScoreText,shooterXYText,bgTextGroup,boxReflectorArr,prizeGroupArr,triangleGroupArr,allGridObjectsArr,shapeNameArr,prizeHitTweenArr;window.addEventListener("resize",function(){resizeGame()});var resizeGame=function(){game.stage.scale.setShowAll(),game.stage.scale.refresh()};game_state.main=function(){},game_state.main.prototype={preload:function(){game.load.spritesheet("boxReflector1","assets/squareBlueSpritesheet.png",100,100),game.load.image("triangleReflector1","assets/triangleWhite1_0.png"),game.load.image("blocker1","assets/square1.png"),game.load.image("shooter1","assets/triangleYellow1_0.png"),game.load.image("redBall","assets/redBall.png"),game.load.image("laser1","assets/laserTexture1.png"),game.load.image("greenBox","assets/greenBox.png"),game.load.spritesheet("fireButton","assets/buttons/FireButton2Frames.png",200,200),game.load.spritesheet("helpButton","assets/buttons/HelpButtonFrames.png",100,100),game.load.audio("sliding","assets/audio/sliding1.mp3"),game.load.audio("slidingPrize","assets/audio/sliding2.mp3"),game.load.audio("slidingTriangle","assets/audio/sliding3.mp3"),game.load.audio("laserFired","assets/audio/shield-hit.mp3"),game.load.audio("shooterDies","assets/audio/dramatic-fall-and-crash.mp3"),game.load.audio("prizeHit","assets/audio/button-select.mp3"),game.load.audio("gameStart","assets/audio/start-game.mp3"),game.load.audio("gameOver","assets/audio/game-over.mp3"),game.load.bitmapFont("pressStart2P","assets/fonts/Press_Start_2P/font.png","assets/fonts/Press_Start_2P/font.xml")},create:function(){gameOver=!0,this.game.onPause.add(gamePaused,this),this.game.onResume.add(gameResumed,this),game.stage.fullScreenScaleMode=Phaser.StageScaleMode.SHOW_ALL,game.stage.scale.setShowAll(),game.stage.scale.pageAlignHorizontally=!0,game.stage.scale.pageAlignVeritcally=!0,game.stage.scale.refresh(),numBlocksVertical=Math.floor(SAFE_ZONE_HEIGHT/gridSize)-2,numBlocksHorizontal=Math.floor(SAFE_ZONE_WIDTH/gridSize)-3,rightLimitX=SAFE_ZONE_WIDTH+extraWidth/2-halfGridSize-gridSize,topLimitY=halfGridSize+extraHeight/2,bottomLimitY=SAFE_ZONE_HEIGHT+extraHeight/2-halfGridSize,leftLimitX=extraWidth/2+halfGridSize,audioSliding=game.add.audio("sliding",.25,!0),audioSlidingPrize=game.add.audio("slidingPrize",.1,!0),audioSlidingTriangle=game.add.audio("slidingTriangle",.25,!0),audioLaserFired=game.add.audio("laserFired",.75,!0),audioShooterDies=game.add.audio("shooterDies",.3,!0),audioPrizeHit=game.add.audio("prizeHit",.75,!0),audioGameStart=game.add.audio("gameStart",.75,!0),audioGameOver=game.add.audio("gameOver",.75,!0),cursors=game.input.keyboard.createCursorKeys(),shapeNameArr=["triangleReflector1","blocker1"],bgDecorationGroup1=game.add.group();for(var a=0;10>a;a++){var b=Math.random()*game.world.width-100,c=Math.random()*game.world.height,d=Phaser.Math.getRandom(shapeNameArr),e=game.add.sprite(b,c,d);e.anchor.setTo(.5,.5),"triangleReflector1"==d&&(e.angle=90*Math.floor(4*Math.random()));var f=2*Math.random()+1;e.scale.setTo(f,f),e.body.velocity.x=20*f/2,e.body.velocity.y=40*f/2,e.events.onOutOfBounds.add(function(a){var b=a.scale.x;a.reset(Math.random()*game.world.width-100,-100),a.body.velocity.x=20*b/2,a.body.velocity.y=40*b/2}),bgDecorationGroup1.add(e)}bgDecorationGroup1.alpha=.1,allGridObjectsArr=[],reflectorGroup1=game.add.group(),triangleGroupArr=[];for(var a=0;15>a;a++){var g=reflectorGroup1.add(createGameElement("triangleReflector1",!0,!0));triangleGroupArr.push(g),allGridObjectsArr.push(g)}boxReflectorArr=[];for(var a=0;5>a;a++){var g=reflectorGroup1.add(createGameElement("boxReflector1"),!1,!1,0);g.animations.add("safeMode",[2,1],1,!1),g.animations.add("flashRed",[3,4],4,!0),g.events.onAnimationComplete.add(function(a){a.frame=0},g),g.frame=0,boxReflectorArr.push(g),allGridObjectsArr.push(g)}for(var a=0;0>a;a++){var g=reflectorGroup1.add(createGameElement("blocker1"));allGridObjectsArr.push(g)}prizeGroupArr=[],prizeGroup=game.add.group();for(var a=0;10>a;a++){var g=prizeGroup.add(createGameElement("greenBox",!1,!1));g.wasHit=!1,prizeGroupArr.push(g),allGridObjectsArr.push(g)}prizeHitTweenArr=[],game.input.onDown.add(clickListener),fireButton=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),fireButton.onDown.add(fireButtonPressed),fireButton.onUp.add(fireButtonReleased),moveLeftKey=game.input.keyboard.addKey(Phaser.Keyboard.A),moveRightKey=game.input.keyboard.addKey(Phaser.Keyboard.D),moveUpKey=game.input.keyboard.addKey(Phaser.Keyboard.W),moveDownKey=game.input.keyboard.addKey(Phaser.Keyboard.S),game.input.keyboard.addKey(Phaser.Keyboard.BACKWARD_SLASH).onDown.add(fullscreenKeyPressed),game.input.keyboard.addKey(Phaser.Keyboard.ZERO).onDown.add(function(){scrambleAllObjects()}),laserLayerBM1=game.add.bitmapData(game.world.width,game.world.height),laserLayerSprite1=game.add.sprite(0,0,laserLayerBM1),laserLayerSprite1.visible=!1,fireButtonSprite=game.add.button(game.world.width-200,game.world.height-200,"fireButton",null,this,0,0,1),fireButtonSprite.onInputDown.add(fireButtonPressed),fireButtonSprite.onInputUp.add(fireButtonReleased),shooter1=game.add.sprite(game.world.centerX,halfGridSize,"shooter1"),shooter1.anchor.setTo(.5,.5),shooter1.visible=!1,gameplayObjectsGroup=game.add.group(),gameplayObjectsGroup.add(fireButtonSprite),gameplayObjectsGroup.visible=!1,1!=shapeScale&&(allGridObjectsArr.forEach(function(a){a.scale.setTo(shapeScale,shapeScale)}),shooter1.scale.setTo(shapeScale,shapeScale));var h={font:"50px PressStart2P",fill:"#ff0044",align:"center"};finalScoreText=game.add.text(game.world.centerX,-500,"",{font:"600px Arial",fill:"#258acc",align:"center"}),finalScoreText.anchor.setTo(.5,.5),finalScoreText.visible=!1,gameOverlayTextGroup=game.add.group(),gameOverlayText=game.add.bitmapText(game.world.centerX,200,"",h),gameOverlayText.anchor.setTo(.5,0),gameOverlayTextGroup.add(gameOverlayText),gameHelpButton=game.add.button(game.world.width-100,game.world.height-100,"helpButton",null,this,0,0,2,0,gameOverlayTextGroup),gameHelpButton.onInputDown.add(helpButtonCallback),gameStartingText=game.add.bitmapText(game.world.centerX,game.world.centerY,"",h),gameStartingText.anchor.setTo(.5,.5),scoreText=game.add.bitmapText(game.world.width-10,10,"",h),scoreText.anchor.setTo(1,0),healthText=game.add.bitmapText(game.world.width-10,110,"",h),healthText.anchor.setTo(1,0),timerText=game.add.bitmapText(game.world.width-10,210,"",h),timerText.anchor.setTo(1,0),introInfoGroup=game.add.group(),introInfoGroup.visible=!1;var i=game.add.graphics(0,0);introInfoGroup.add(i),i.beginFill("0x000000",.7),i.drawRect(0,0,game.width,game.height);var j=game.add.sprite(halfGridSize,game.world.height-3*halfGridSize,"greenBox");j.anchor.setTo(.5,.5),j.scale.setTo(1,1),introInfoGroup.add(j);var k=game.add.sprite(game.world.centerX,game.world.height-halfGridSize,"greenBox");k.anchor.setTo(.5,.5),k.scale.setTo(1,1),introInfoGroup.add(k);var l=game.add.sprite(game.world.width-halfGridSize,5*halfGridSize,"greenBox");l.anchor.setTo(.5,.5),l.scale.setTo(1,1),introInfoGroup.add(l),i.lineStyle(10,16711680,1),i.moveTo(halfGridSize,halfGridSize),i.lineTo(game.world.width-halfGridSize,halfGridSize),i.lineTo(game.world.width-halfGridSize,game.world.height-halfGridSize),i.lineTo(halfGridSize,game.world.height-halfGridSize),i.lineTo(halfGridSize,halfGridSize+3*gridSize);var m=game.add.sprite(halfGridSize,halfGridSize,"shooter1");m.anchor.setTo(.5,.5),introInfoGroup.add(m);var n=game.add.sprite(game.world.width-halfGridSize,halfGridSize,"triangleReflector1");n.anchor.setTo(.5,.5),n.angle=180,introInfoGroup.add(n);var o=game.add.sprite(game.world.width-halfGridSize,game.world.height-halfGridSize,"triangleReflector1");o.anchor.setTo(.5,.5),introInfoGroup.add(o),o.angle=270;var p=game.add.sprite(halfGridSize,game.world.height-halfGridSize,"triangleReflector1");p.anchor.setTo(.5,.5),introInfoGroup.add(p);var q=game.add.sprite(halfGridSize,3*gridSize+halfGridSize,"blocker1");q.anchor.setTo(.5,.5),introInfoGroup.add(q);var r=game.add.sprite(halfGridSize,2*gridSize+halfGridSize,"boxReflector1");r.anchor.setTo(.5,.5),introInfoGroup.add(r);var s={font:"20px PressStart2P",fill:"#ffffff",align:"left"};introText=game.add.bitmapText(120,game.world.centerY,"",s),introText.anchor.setTo(0,.5),introInfoGroup.add(introText),game.time.events.add(2*Phaser.Timer.SECOND,function(){introText.setText("Welcome to LAZOR REFLEKTOR!!!\n\nThe object of the game is to fire your laser\nand try to hit the green prize boxes without\nhitting a blue reflector box because they\nwill bounce the laser back along its path and\nkill you. The triangle shaped reflectors will\nbounce the laser and change it’s path. And\nthe white boxes will absorb/block the laser.\n\nYou can temporarily neutralize a blue reflector\nbox by touching it (or clicking it). A laser \nbeam that hits a neutralized box will not reflect\nbackwards and so is safe to hit (but only very \nbriefly).\n\nYou may drag the triangle reflectors around\nbut they will rotate as you do so.\n\nEach prize hit will add to your score and will \nadd 2 seconds of game time. The more times the \nlaser is bounced around by the triangle \nreflectors, the more points per prize hit. But \nthe more likely you will accidentally hit a blue \nreflector and so be killed.\n\nThe game is over when all 5 player lives are\nlost or when you run out of time, whichever \ncomes first.\n\nFeel free to leave comments or suggestions at\nlazor.reflektor@gmail.com\n"),gameOverlayText.setText("LAZOR REFLEKTOR!!!\n\n\n\nGAME OVER\n\ntouch or press spacebar\nto start")
},this)},update:function(){var a=shooter1.angle;shooter1.body.acceleration.setTo(0,0),gameOver||shooterDead||(90==Math.abs(a)&&moveLeftKey.isDown?shooter1.body.acceleration.x=-shooterAcceleration:90==Math.abs(a)&&moveRightKey.isDown?shooter1.body.acceleration.x=shooterAcceleration:180!=Math.abs(a)&&0!=a||!moveDownKey.isDown?180!=Math.abs(a)&&0!=a||!moveUpKey.isDown||(shooter1.body.acceleration.y=-shooterAcceleration):shooter1.body.acceleration.y=shooterAcceleration),reorientShooterAsNecessary(),game.time.now>timeMarkerUpdateBgTextGroup&&(shooterXYText&&shooterXYText.setText(shooter1.x+"\n"+shooter1.y),timeMarkerUpdateBgTextGroup=game.time.now+1e3),game.time.now>timeMarkerMoveBlueSquares&&(updateObjectPositions(boxReflectorArr),timeMarkerMoveBlueSquares=game.time.now+5e3*Math.random()+5e3),game.time.now>timeMarkerMovePrizes&&(updateObjectPositions(prizeGroupArr),timeMarkerMovePrizes=game.time.now+5e3*Math.random()+5e3),game.time.now>timeMarkerTweakTriangles&&(updateObjectPositions(triangleGroupArr),timeMarkerTweakTriangles=game.time.now+5e3*Math.random()+2e3)},render:function(){game.debug.renderText("w="+w+", h="+h+", window.devicePixelRatio="+window.devicePixelRatio,10,10),game.debug.renderText("game.width="+game.width+", game.height="+game.height,10,50),game.debug.renderText("screen.width="+screen.width+", screen.height="+screen.height,10,100)}},game.state.add("main",game_state.main),game.state.start("main");